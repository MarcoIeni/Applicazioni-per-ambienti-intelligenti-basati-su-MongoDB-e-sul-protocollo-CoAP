<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Marco Ieni">
<title>Applicazioni per ambienti intelligenti basati su MongoDB e sul protocollo CoAP</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Applicazioni per ambienti intelligenti basati su MongoDB e sul protocollo CoAP</h1>
<div class="details">
<span id="author" class="author">Marco Ieni</span><br>
<span id="email" class="email"><a href="mailto:marcoieni94@gmail.com">marcoieni94@gmail.com</a></span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Indice</div>
<ul class="sectlevel1">
<li><a href="#_introduzione">Introduzione</a></li>
<li><a href="#_analisi_delle_tecnologie_adoperate">1. Analisi delle tecnologie adoperate</a>
<ul class="sectlevel2">
<li><a href="#_coap">1.1. CoAP</a>
<ul class="sectlevel3">
<li><a href="#_nodi_vincolati">1.1.1. Nodi vincolati</a></li>
<li><a href="#_reti_vincolate">1.1.2. Reti vincolate</a></li>
<li><a href="#_il_protocollo">1.1.3. Il protocollo</a></li>
</ul>
</li>
<li><a href="#_cloud">1.2. Cloud</a>
<ul class="sectlevel3">
<li><a href="#_che_cos_è">1.2.1. Che cos&#8217;è</a></li>
<li><a href="#_caratteristiche">1.2.2. Caratteristiche</a></li>
<li><a href="#_perchè_utilizzarlo">1.2.3. Perchè utilizzarlo</a></li>
<li><a href="#_aspetti_economici">1.2.4. Aspetti economici</a></li>
<li><a href="#_cloud_ibrido">1.2.5. Cloud ibrido</a></li>
</ul>
</li>
<li><a href="#_mongodb">1.3. MongoDB</a>
<ul class="sectlevel3">
<li><a href="#_i_documenti">1.3.1. I documenti</a></li>
<li><a href="#_scalabilità">1.3.2. Scalabilità</a></li>
<li><a href="#_disponibilità_del_servizio_e_affidabilità">1.3.3. Disponibilità del servizio e affidabilità</a></li>
<li><a href="#_performance">1.3.4. Performance</a></li>
<li><a href="#_durabilità_dell_informazione">1.3.5. Durabilità dell’informazione</a></li>
<li><a href="#_indicizzazione">1.3.6. Indicizzazione</a></li>
<li><a href="#_ordinamento">1.3.7. Ordinamento</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_scelta_dell_implementazione_del_coap">2. Scelta dell&#8217;implementazione del CoAP</a>
<ul class="sectlevel2">
<li><a href="#_jcoap">2.1. jCoAP</a>
<ul class="sectlevel3">
<li><a href="#_server">2.1.1. Server</a></li>
<li><a href="#_client">2.1.2. Client</a></li>
<li><a href="#_motivazioni_dell_abbandono">2.1.3. Motivazioni dell&#8217;abbandono</a></li>
</ul>
</li>
<li><a href="#_californium">2.2. Californium</a>
<ul class="sectlevel3">
<li><a href="#_interruttore">2.2.1. Interruttore</a></li>
<li><a href="#_server_2">2.2.2. Server</a></li>
<li><a href="#_lampadina">2.2.3. Lampadina</a></li>
<li><a href="#_motivazioni_dell_abbandono_2">2.2.4. Motivazioni dell&#8217;abbandono</a></li>
</ul>
</li>
<li><a href="#_coapthon">2.3. CoAPthon</a>
<ul class="sectlevel3">
<li><a href="#_coapclient">2.3.1. CoAPclient</a></li>
<li><a href="#_errori_riscontrati_e_risoluzione">2.3.2. Errori riscontrati e risoluzione</a></li>
<li><a href="#_motivazioni_della_scelta">2.3.3. Motivazioni della scelta</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_il_sistema_sviluppato">3. Il sistema sviluppato</a>
<ul class="sectlevel2">
<li><a href="#_scenario_di_riferimento">3.1. Scenario di riferimento</a>
<ul class="sectlevel3">
<li><a href="#_vincoli_progettuali">3.1.1. Vincoli progettuali</a></li>
</ul>
</li>
<li><a href="#_obiettivi">3.2. Obiettivi</a></li>
<li><a href="#_la_soluzione">3.3. La soluzione</a>
<ul class="sectlevel3">
<li><a href="#_schema">3.3.1. Schema</a></li>
<li><a href="#_gestione_della_sicurezza">3.3.2. Gestione della sicurezza</a></li>
<li><a href="#_gerarchia_dei_gruppi">3.3.3. Gerarchia dei gruppi</a></li>
<li><a href="#_gestione_dei_tag">3.3.4. Gestione dei tag</a></li>
</ul>
</li>
<li><a href="#_requisiti">3.4. Requisiti</a>
<ul class="sectlevel3">
<li><a href="#_utente">3.4.1. Utente</a></li>
<li><a href="#_server_remoto">3.4.2. Server remoto</a></li>
<li><a href="#_server_coap">3.4.3. Server CoAP</a></li>
<li><a href="#_dispositivi">3.4.4. Dispositivi</a></li>
</ul>
</li>
<li><a href="#_funzionalità">3.5. Funzionalità</a>
<ul class="sectlevel3">
<li><a href="#_soglia_dei_sensori">3.5.1. Soglia dei sensori</a></li>
<li><a href="#_servizi_personalizzati">3.5.2. Servizi personalizzati</a></li>
</ul>
</li>
<li><a href="#_casi_d_uso">3.6. Casi d&#8217;uso</a>
<ul class="sectlevel3">
<li><a href="#_login">3.6.1. Login</a></li>
<li><a href="#_leggere_le_misurazioni_del_sensore">3.6.2. Leggere le misurazioni del sensore</a></li>
<li><a href="#_attivare_un_servizio_su_un_gruppo_di_attuatori">3.6.3. Attivare un servizio su un gruppo di attuatori</a></li>
<li><a href="#_inserimento_di_un_nuovo_sensore">3.6.4. Inserimento di un nuovo sensore</a></li>
<li><a href="#_inserimento_di_un_nuovo_attuatore">3.6.5. Inserimento di un nuovo attuatore</a></li>
<li><a href="#_inserimento_di_una_misurazione">3.6.6. Inserimento di una misurazione</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_dettagli_implementativi">4. Dettagli implementativi</a>
<ul class="sectlevel2">
<li><a href="#_linguaggi_di_programmazione">4.1. Linguaggi di Programmazione</a></li>
<li><a href="#_gruppi">4.2. Gruppi</a>
<ul class="sectlevel3">
<li><a href="#_gestione_della_gerarchia">4.2.1. Gestione della gerarchia</a></li>
<li><a href="#_gruppi_di_attuatori">4.2.2. Gruppi di attuatori</a></li>
<li><a href="#_gruppi_di_sensori">4.2.3. Gruppi di sensori</a></li>
</ul>
</li>
<li><a href="#_gestione_della_privacy_e_della_sicurezza">4.3. Gestione della privacy e della sicurezza</a>
<ul class="sectlevel3">
<li><a href="#_approccio_ibrido_sql_e_nosql">4.3.1. Approccio ibrido SQL e NoSQL</a></li>
<li><a href="#_accesso_ai_dispositivi">4.3.2. Accesso ai dispositivi</a></li>
<li><a href="#_gestione_delle_chiavi">4.3.3. Gestione delle chiavi</a></li>
</ul>
</li>
<li><a href="#_shell">4.4. Shell</a>
<ul class="sectlevel3">
<li><a href="#_lato_client">4.4.1. Lato client</a></li>
<li><a href="#_lato_server">4.4.2. Lato server</a></li>
</ul>
</li>
<li><a href="#_diagramma_delle_classi">4.5. Diagramma delle classi</a></li>
<li><a href="#_ulteriori_dettagli">4.6. Ulteriori dettagli</a>
<ul class="sectlevel3">
<li><a href="#_installazione_delle_dipendenze">4.6.1. Installazione delle dipendenze</a></li>
<li><a href="#_correzione_della_gestione_del_log">4.6.2. Correzione della gestione del log</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_sperimentazione">5. Sperimentazione</a>
<ul class="sectlevel2">
<li><a href="#_scenario_di_riferimento_2">5.1. Scenario di riferimento</a></li>
<li><a href="#_obiettivo">5.2. Obiettivo</a></li>
<li><a href="#_soluzione_sviluppata">5.3. Soluzione sviluppata</a></li>
<li><a href="#_possibili_scenari">5.4. Possibili scenari</a>
<ul class="sectlevel3">
<li><a href="#_mattinata_fredda_infrasettimanale">5.4.1. Mattinata fredda infrasettimanale</a></li>
<li><a href="#_giornata_di_sola_attività_amministrativa">5.4.2. Giornata di sola attività amministrativa</a></li>
<li><a href="#_riunione_di_dipartimento_in_una_giornata_calda">5.4.3. Riunione di dipartimento in una giornata calda</a></li>
</ul>
</li>
<li><a href="#_inserimento_dei_dati_nel_sistema">5.5. Inserimento dei dati nel sistema</a></li>
</ul>
</li>
<li><a href="#_conclusioni_e_sviluppi_futuri">Conclusioni e sviluppi futuri</a>
<ul class="sectlevel2">
<li><a href="#_strumenti_utilizzati">Strumenti utilizzati</a></li>
</ul>
</li>
<li><a href="#_glossario">Glossario</a></li>
<li><a href="#_bibliografia">Bibliografia</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduzione">Introduzione</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;obiettivo della tesi è la realizzazione di un sistema di monitoraggio e gestione di un ambiente intelligente.
Gli utenti del sistema possono accedere ai servizi personalizzati e dinamici, che integrano i dati ambientali (provenienti da sensori) con le esigenze degli
utenti, modificando le caratteristiche dell&#8217;ambiente stesso (tramite gli attuatori). Il sistema sviluppato sfrutta il protocollo CoAP come protocollo di
comunicazione tra i dispositivi embedded (sensori ed attuatori) e immagazzina l&#8217;ingente quantità di dati che viene continuamente prodotta dai sensori per il
monitoraggio ambientale nel Cloud, mediante il DBMS MongoDB.</p>
</div>
<div class="paragraph">
<p>Il lavoro della tesi è stato portato avanti in modo da fornire un&#8217;analisi ed un&#8217;implementazione delle tecnologie considerate, creando un sistema
flessibile e funzionale per varie applicazioni.</p>
</div>
<div class="paragraph">
<p>Il servizio finale consente all’utente di:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tenere sotto controllo i propri sensori, visualizzandone le misure effettuate nel tempo (anche applicando filtri come tag, gruppi o posizione);</p>
</li>
<li>
<p>comandare i propri attuatori, stabilendo regole di funzionamento in base all&#8217;orario e alla locazione dell&#8217;interruttore attivato, accendendo solo determinate luci oppure caricando da remoto un proprio programma in python da eseguire ottenendo, così, dei servizi personalizzati;</p>
</li>
<li>
<p>raggruppare i dispositivi in gruppi, in modo tale da avere una gestione più semplificata;</p>
</li>
<li>
<p>rendere pubblici i propri dispositivi, in modo che tutti gli utenti registrati nel sistema possano accedervi;</p>
</li>
<li>
<p>creare gruppi di utenti che hanno accesso solo a determinati gruppi di dispositivi.<br>
Per esemplificare, si pensi ad un&#8217;università in cui tutte le porte siano considerate degli attuatori collegati a uno strumento capace di identificare un utente (lettore di impronte digitali, tastierino numerico, card reader, ecc.). Si potrebbe abilitare a un gruppo di tirocinanti l’apertura di tutte le porte che conducono al laboratorio dove devono recarsi, in modo tale da farli accedere solamente a determinate zone e salvare l’orario di entrata e di uscita dal laboratorio di ogni tirocinante;</p>
</li>
<li>
<p>ottenere informazioni in base alla posizione dei dispositivi. Ad esempio, è possibile ottenere una media della temperatura di un determinato luogo pesata in base alla precisione di ogni dispositivo a cui si ha accesso nelle vicinanze di un determinato punto, identificato da latitudine e longitudine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il presente lavoro si articola in quattro capitoli:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Capitolo 1 - Analisi delle tecnologie adoperate</dt>
<dd>
<p>Nel primo capitolo vengono analizzati nel dettaglio:</p>
<div class="ulist">
<ul>
<li>
<p>il protocollo CoAP, approfondendo anche il motivo per cui esso è di fondamentale importanza per la comunicazione dei sistemi embedded;</p>
</li>
<li>
<p>analisi di soluzioni cloud-based, esaminandone vantaggi e svantaggi rispetto all’approccio centralizzato.</p>
</li>
<li>
<p>MongoDB, descrivendo tutte le principali peculiarità di questa tipologia di database;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Capitolo 2 - Scelta dell&#8217;implementazione CoAP</dt>
<dd>
<p>Nel secondo capitolo si riporta tutto il percorso che ha portato alla scelta dell&#8217;implementazione del CoAP da utilizzare, analizzando svantaggi, vantaggi e codici creati per ogni implementazione studiata.</p>
</dd>
<dt class="hdlist1">Capitolo 3 - Il sistema sviluppato</dt>
<dd>
<p>Nel terzo capitolo viene presentato il sistema sviluppato, analizzando lo scenario di riferimento e i vincoli che esso impone, lo schema del sistema e le sue funzionalità (anche mediante l’ausilio dei sequence diagram).</p>
</dd>
<dt class="hdlist1">Capitolo 4 - Dettagli implementativi</dt>
<dd>
<p>Nel quarto capitolo vengono illustrati alcuni screenshot della shell, che mostrano il funzionamento del sistema e i dettagli implementativi, come le query e le parti di codice più importanti e il diagramma delle classi principali.</p>
</dd>
<dt class="hdlist1">Capitolo 5 - Sperimentazione</dt>
<dd>
<p>Nel quinto capitolo viene mostrato un particolare scenario applicativo utilizzato per testare il sistema sviluppato.
In particolare, la sperimentazione è stata fatta ipotizzando un campus univeristario, ed implementando un servizio Smart Building Activity Based.
Tale servizio permette di controllare i consumi elettrici legati al riscaldamento dell&#8217;edificio del campus.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Sono inoltre presenti le conclusioni e la bibliografia.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analisi_delle_tecnologie_adoperate">1. Analisi delle tecnologie adoperate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le tecnologie più innovative impiegate nel progetto sono il protocollo CoAP, MongoDB e il cloud. Esse sono
strettamente collegate tra loro e l&#8217;impiego di una, spesso, implica anche quello di un&#8217;altra.</p>
</div>
<div class="paragraph">
<p>Il CoAP, ad esempio, è utilizzato nell&#8217;ambito dell&#8217;IoT, l&#8217;internet delle cose, un nuovo trend che vede protagonisti gli oggetti che comunicano con la rete per inviare e ricevere dati. Il problema è che gli oggetti collegati ad internet saranno moltissimi e, di conseguenza, la mole di dati prodotta sarà così grande da non potere essere gestita da un solo server, per quanto potente esso possa essere. Si sente dunque l&#8217;esigenza di passare da un approccio verticale, in cui si potenzia sempre di più un server centrale, a un approccio orizzontale, in cui si aggiungono altre macchine a cooperare tra di loro, ovvero da un sistema centralizzato a uno distribuito.</p>
</div>
<div class="paragraph">
<p>Quest&#8217;ultimo sistema è detto Cloud e può essere sia a livello applicativo sia a livello dati. Per utilizzare il cloud a livello dati non possono essere utilizzate le tecnologie dei database relazionali, poiché questi presuppongono che tutte le tabelle del database siano contenute su una sola macchina, ma si devono impiegare i database non relazionali, in quanto questi ultimi consentono di distribuire i dati di uno stesso database su più server.</p>
</div>
<div class="paragraph">
<p>Un esempio di Database Management System non relazionale è MongoDB, poiché si allontana dalla struttura tradizionale basata sulle tabelle dei database relazionali in favore di documenti in stile JSON con schema dinamico rendendo, così, l&#8217;integrazione di dati di alcuni tipi di applicazioni più facile e veloce. Tra i vari DBMS non relazionali si è scelto MongoDB perché è un software libero, open souce, stabile e ben documentato. Inoltre è utilizzato come backend da un alto numero di grandi siti web e società di servizi come eBay, Foursquare, SourceForge e il New York Times <sup class="footnote" id="_footnote_wiki-MongoDB">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>.
Dopo aver spiegato il perché della scelta di queste tecnologie, di seguito verranno approfondite una per una.</p>
</div>
<div class="sect2">
<h3 id="_coap">1.1. CoAP</h3>
<div class="quoteblock">
<blockquote>
Il Constrained Application Protocol (CoAP) è un protocollo di trasferimento web specializzato per l’uso con nodi vincolati e reti vincolate nel contesto dell’Internet delle cose.
</blockquote>
<div class="attribution">
&#8212; http://coap.technology/
</div>
</div>
<div class="paragraph">
<p>Il protocollo è di tipo RESTful e di livello applicativo, mentre la definizione e la descrizione di “nodi vincolati”
e “reti vincolate” si può trovare nell’RFC 7228 <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup>.</p>
</div>
<div class="sect3">
<h4 id="_nodi_vincolati">1.1.1. Nodi vincolati</h4>
<div class="paragraph">
<p>Un nodo vincolato è un nodo dove alcune delle caratteristiche che molto spesso sono date per scontate per i classici nodi di internet non sono presenti, spesso a causa di vincoli di costo e/o fisici come la dimensione, il peso e la potenza e l’energia disponibili.</p>
</div>
<div class="paragraph">
<p>In primo luogo vi sono limiti stretti su potenza, memoria e capacità di elaborazione delle risorse che rendono l’ottimizzazione di energia, codice e larghezza di banda una parte importante dei requisiti di progettazione. Inoltre, servizi di secondo livello come connettività completa, broadcast e multicast talvolta possono anche mancare.</p>
</div>
<div class="paragraph">
<p>Un altro vincolo può essere quello della mancanza di una interfaccia utente e della scarsa accessibilità in distribuzione che può comportare, per esempio, l’impossibilità di aggiornare il software.</p>
</div>
<div class="paragraph">
<p>Anche se questa non è una definizione rigorosa, definisce chiaramente il distacco tra i nodi vincolati e altri sistemi più potenti come i server tradizionali, computer desktop, laptop o potenti dispositivi mobile come tablet e smartphone.</p>
</div>
<div class="paragraph">
<p>L’uso di nodi vincolati spesso porta anche a vincoli sulle reti stesse, ma ci possono anche essere vincoli sulle reti che sono ampiamente indipendenti da quelli dei nodi. Per questo motivo si distinguono i “nodi vincolati” dalle “reti vincolate”.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reti_vincolate">1.1.2. Reti vincolate</h4>
<div class="paragraph">
<p>Le reti vincolate sono definite come reti in cui alcune delle caratteristiche date per scontato con gli strati di collegamento di uso comune nelle reti dell’internet odierna non sono disponibili e, quindi, vi sono dei vincoli di progettazione. Questi vincoli possono includere:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bassa bitrate;</p>
</li>
<li>
<p>perdita di pacchetti e alta variabilità della perdita di pacchetti;</p>
</li>
<li>
<p>caratteristiche di collegamento molto asimmetriche;</p>
</li>
<li>
<p>severe penalità per l’utilizzo di pacchetti di grandi dimensioni (ad esempio a causa di un alto tasso di perdita di pacchetti);</p>
</li>
<li>
<p>limiti di raggiungibilità nel tempo, poichè un numero considerevole di dispositivi potrebbe spegnersi in qualsiasi
momento, per poi svegliarsi e comunicare per un breve periodo di tempo;</p>
</li>
<li>
<p>mancanza di servizi avanzati come il multicast.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_il_protocollo">1.1.3. Il protocollo</h4>
<div class="paragraph">
<p>Il CoAP, dunque, è stato creato per risolvere e nascondere al programmatore quasi tutte le problematiche elencate sia
per i nodi che per le reti vincolate e presenta le seguenti caratteristiche:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>è basato sul modello REST quindi, come per l&#8217;HTTP, i server rendono disponibili le risorse attraverso una URL e i client accedono a queste risorse usando metodi come GET, PUT, POST e DELETE;</p>
</li>
<li>
<p>riesce a utilizzare risorse minime, sia sul dispositivo che sulla rete, perché invece di uno stack di trasporto complesso come il TCP, lavora con l&#8217;UDP, che non è orientato alla connessione e non implementa i controlli del flusso e della congestione, più adatti per scambiare messaggi di grosse dimensioni.
Inoltre presenta un header fissato a quattro byte e una codifica compatta di opzioni, che consentono ai piccoli messaggi di non causare frammentazione;</p>
</li>
<li>
<p>molti server possono operare senza stato;</p>
</li>
<li>
<p>chiavi RSA a 3072 bit come scelta predefinita dei parametri DTLS. Questo aspetto è molto importante, infatti una delle cose che impedisce di più all&#8217;IoT di diffondersi è la questione della sicurezza. A tal proposito il CoAP offre una protezione avanzata senza per questo compromettere il funzionamento persino sui nodi meno potenti;</p>
</li>
<li>
<p>collegamento semplice tra HTTP e CoAP mediante proxy cross-protocol, dal momento che condividono lo stesso modello REST: un web client che utilizza HTTP può anche non accorgersi che sta accedendo a una risorsa di un sensore, in quanto il server CoAP locale può occuparsi di inoltrare ai nodi della sottorete le richieste in CoAP, traducendole da quelle HTTP originali;</p>
</li>
<li>
<p>servizi di discovery già integrati nel protocollo, in quanto è già presente un modo per scoprire le proprietà dei nodi della rete;</p>
</li>
<li>
<p>come HTTP, il CoAP può trasportare diversi tipi di payload e può anche identificare che tipo di payload si sta usando, compresi formati come XML, JSON, CBOR e molti altri che sono già integrati di base;</p>
</li>
<li>
<p>ottimizzato per funzionare anche su controllori con 10KB di RAM e 100KB di spazio di codice. Per capire l&#8217;importanza e la potenzialità di questa caratteristica basta pensare che si prevede che l&#8217;Internet of Things avrà bisogno di miliardi di nodi. Ovviamente meno questi nodi saranno costosi, più grande sarà il risparmio complessivo, quindi avere un protocollo che funziona bene anche su dispositivi con prestazioni estremamente basse è essenziale;</p>
</li>
<li>
<p>osservazione di risorse con il modello publish/subscribe, ovvero un server notifica i client che si sono registrati a una specifica risorsa quando questa cambia;</p>
</li>
<li>
<p>resource discovery già integrata e supporto a trasmissione di grandi quantità di dati, suddividendo i dati in blocchi nel mittente e ricomponendoli al livello applicativo in ricezione (questa feature è chiamata block-wise transfer);</p>
</li>
<li>
<p>supporto nativo al multicast;</p>
</li>
<li>
<p>affidabilità della comunicazione. Nonostante il CoAP sia basato su UDP, infatti, è implementato un meccanismo per garantire che i messaggi siano stati ricevuti dal destinatario. In particolare, per un determinato intervallo di tempo, quando si invia un pacchetto si aspetta un ACK, che può contenere anche un eventuale payload e, se questo non arriva, viene ritrasmesso il messaggio; al termine dell&#8217;intervallo il pacchetto si considera scaduto e, quindi, non ricevuto dal destinatario.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tutte queste caratteristiche rendono il CoAP il protocollo ideale per impieghi che rientrano nelle architetture dell&#8217;IoT.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cloud">1.2. Cloud</h3>
<div class="paragraph">
<p>Per approfondire la tecnologia del Cloud sono stati letti e analizzati vari articoli di Joe Wienman, il fondatore di Cloudonomics, un
rigoroso approccio analitico e multidisciplinare che coinvolge economia, economia comportamentale, statistica, matematica, teoria della complessità computazionale, simulazione e teoria dei sistemi per caratterizzare il talvolta poco intuitivo business multi-dimensionale e i benefici dell’esperienza utente del cloud computing e di altri modelli di business on-demand e pay-per-use <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup>.</p>
</div>
<div class="sect3">
<h4 id="_che_cos_è">1.2.1. Che cos&#8217;è</h4>
<div class="quoteblock">
<blockquote>
In informatica con il termine inglese cloud computing (in italiano "nuvola informatica") si indica un paradigma di erogazione di risorse informatiche, come l&#8217;archiviazione, l&#8217;elaborazione o la trasmissione di dati, caratterizzato dalla disponibilità on demand attraverso Internet a partire da un insieme di risorse preesistenti e configurabili.
</blockquote>
<div class="attribution">
&#8212; Peter Mell&#44; Timothy Grance<br>
<cite>The NIST Definition of Cloud Computing. NIST&#44; Special Publication 800-145&#44; Settembre 2011.</cite>
</div>
</div>
<div class="paragraph">
<p>Le risorse non vengono pienamente configurate e messe in opera dal fornitore apposta per l&#8217;utente, ma gli sono assegnate, rapidamente e convenientemente, grazie a procedure automatizzate, a partire da un insieme di risorse condivise con altri utenti, lasciando all&#8217;utente parte dell&#8217;onere della configurazione. Quando l&#8217;utente rilascia la risorsa, essa viene similmente riconfigurata nello stato iniziale e rimessa a disposizione nel pool condiviso delle risorse, con altrettanta velocità ed economia per il fornitore <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Alcuni esempi che mostrano le potenzialità del cloud sono:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Messaggiare tramite smartphone;</p>
</li>
<li>
<p>Condividere foto e aggiornamenti su Facebook o Twitter;</p>
</li>
<li>
<p>Guardare un video di Youtube su una TV;</p>
</li>
<li>
<p>Condividere file su Dropbox.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ma oltre a queste applicazioni che coinvolgono l’uomo, ve ne sono molte altre che coinvolgono le macchine (IoT), in cui una varietà di
endpoints sono connessi al cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Telecamere di videosorveglianza che mandano video in diretta a un archivio di video basato sul cloud per una maggiore sicurezza;</p>
</li>
<li>
<p>Device che monitorano continuamente alcuni parametri dei pazienti, come la pressione sanguigna, i battiti cardiaci, che possono
essere mandati all’ospedale più vicino in caso di valori al di fuori del normale;</p>
</li>
<li>
<p>Case intelligenti con dispositivi in grado di spegnere ed accendere a distanza dispositivi ad alto consumo come condizionatori,
lavatrici, asciugatrici e lavastoviglie, in modo da ridurre al minimo i consumi;</p>
</li>
<li>
<p>Fattorie che monitorano lo stato dell’ambiente, come la temperatura, le precipitazioni, per assicurare che il terreno riceva esattamente
l’irrigazione necessaria. <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_caratteristiche">1.2.2. Caratteristiche</h4>
<div class="paragraph">
<p>Un&#8217;analisi delle caratteristiche principali di un servizio cloud-based viene effettuata nell&#8217;articolo di Joe Weinman
"Cloudonomics: A Rigorous Approach to Cloud Benefit Quantification" <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup>. Esse sono:</p>
</div>
<div class="sect4">
<h5 id="_infrastruttura_em_c_em_omune">Infrastruttura <em>C</em>omune</h5>
<div class="paragraph">
<p>Le risorse sono standardizzate, condivise e allocate dinamicamente.</p>
</div>
<div class="paragraph">
<p>La penalità del costo del servizio segue la funzione
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mfrac>
      <mn>1</mn>
      <msqrt>
        <mi>m</mi>
      </msqrt>
    </mfrac>
  </mstyle>
</math>
, dove m sta per il numero di richieste indipendenti che riceve il sistema. Questo vuol dire che più richieste ci sono, più il costo che si paga per mantenere il servizio è “giustificato”, perché lo si sta sfruttando. Se invece ci sono poche richieste rispetto a quelle supportate, il costo che si sta pagando per gestire più richieste è, ovviamente, uno spreco.</p>
</div>
<div id="img-function1" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/function1_sqrt.png" alt="Andamento della penalità del costo del servizio">
</div>
<div class="title">Figure 1. Andamento della penalità del costo del servizio</div>
</div>
<div class="paragraph">
<p>Come si nota dal grafico la funzione è decrescente, quindi più m è grande, più la penalità del costo si abbassa, ma se m aumenta troppo bisogna aumentare la capacità del sistema e, quindi, investire altri soldi in esso perchè, se la capacità del sistema sarà troppo piccola rispetto alle richieste ricevute, quest&#8217;ultimo soffrità di un&#8217;alta latenza e verrà a mancare la reattività dell’applicazione del consumatore.</p>
</div>
</div>
<div class="sect4">
<h5 id="_indipendenza_dalla_em_l_em_ocazione">Indipendenza dalla <em>L</em>ocazione</h5>
<div class="paragraph">
<p>La reattività del servizio non tiene conto della posizione dell’utente, perchè i server possono essere sparsi ovunque, con benefici derivanti dalla riduzione della latenza e la valorizzazione dell’esperienza dell’utente.</p>
</div>
<div class="paragraph">
<p>La latenza è fortemente, ma non perfettamente, correlata con la distanza. La ragione di questa imperfezione ha a che fare con le anomalie a livello fisico della rete, come gli hop dei router, il tempo di conversione tra ottico ed elettronico e viceversa, le congestioni, i collegamenti antiquati, ecc.</p>
</div>
<div class="paragraph">
<p>Su un piano, sia per il caso peggiore sia per quello atteso, la latenza è proporzionale al raggio del cerchio centrato sul nodo. Di conseguenza, l’area coperta è proporzionale al raggio e al numero di nodi (Weinman, 2011).</p>
</div>
<div class="paragraph">
<p>In particolare, per n nodi su un piano, l’area A coperta dipende dal raggio r, correlato con la latenza/distanza, e una costante di proporzionalità k che dipende dalla strategia di copertura. Si deduce, dunque, che
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>A</mi>
    <mo>=</mo>
    <mi>k</mi>
    <mi>n</mi>
    <mo>&#x3C0;</mo>
    <msup>
      <mi>r</mi>
      <mn>2</mn>
    </msup>
  </mstyle>
</math>. Pertanto, se l’area A è una costante, si ricava che
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>r</mi>
    <mo>&#x221D;</mo>
    <mfrac>
      <mn>1</mn>
      <mrow>
        <msqrt>
          <mrow>
            <mi>n</mi>
          </mrow>
        </msqrt>
      </mrow>
    </mfrac>
  </mstyle>
</math>
dove n sta per il numero di nodi aggiustato di un fattore
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mfrac>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
          <mi>cos</mi>
          <mrow>
            <mo>(</mo>
            <mn>2</mn>
            <mi>&#x3B2;</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
      </mrow>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
          <mi>cos</mi>
          <mrow>
            <mo>(</mo>
            <mi>&#x3B2;</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
      </mrow>
    </mfrac>
  </mstyle>
</math>. Quindi, come si deduce dall’andamento della funzione, se si hanno pochi nodi e se ne aggiungono altri, si ottiene un miglioramento notevole nella latenza mentre, se di base si hanno già molti nodi, il miglioramento sarà esiguo.</p>
</div>
<div class="paragraph">
<p>Si faccia un esempio trascurando il fattore di aggiustamento e supponendo di avere un servizio che viene offerto a 100000 utenti, in cui ogni richiesta da parte di un utente impieghi un tempo di elaborazione di 1ms e che 20200 di questi utenti facciano richiesta contemporaneamente. Se si avesse solamente un nodo, il sistema sarebbe pronto ad accettare nuove richieste dopo 20,2 secondi. Se aggiungessimo un altro nodo 10100 utenti verrebbero diretti verso il primo nodo e altri 10100 verso l’altro, quindi da 20,2 secondi un ipotetico 202001° utente che faccia richiesta qualche istante dopo arriverebbe ad aspettare 10,1 secondi, ottenendo un miglioramento del 50%. Si ponga, invece, il caso in cui il sistema sia formato da 100 nodi. Per lo stesso numero di richieste ogni nodo ne gestirebbe 202 e, quindi, il sistema sarebbe pronto a gestire nuove richieste dopo 202ms. Se si aggiungesse 1 nodo al sistema, ogni nodo gestirebbe 200 nodi e quindi il sistema sarebbe pronto dopo 200ms piuttosto che 202ms. Come si nota dai risultati, il miglioramento, che nel primo caso era di ben 10,1 secondi, ora è solo di 2ms, cioè appena dello 0,99%.</p>
</div>
<div class="paragraph">
<p>Per quanto riguarda il fattore di aggiustamento esso serve a tenere in considerazione la distanza tra nodo e utente, che ovviamente più è elevata, più va a pesare sulla latenza. β è l’angolo formato dal nodo e dall’utente, con vertice preso al centro della terra. Questo coefficiente è molto significativo quando i nodi non sono dislocati in maniera omogenea sul pianeta, mentre se ci sono molti nodi ben disseminati sulla superficie terrestre β sarà molto piccolo, perché ogni utente avrà un nodo vicino ad esso e quindi il fattore tenderà ad 1.</p>
</div>
</div>
<div class="sect4">
<h5 id="_accessibilità_em_o_em_line">Accessibilità <em>O</em>line</h5>
<div class="paragraph">
<p>Un servizio cloud-based è più flessibile rispetto ad uno centralizzato.</p>
</div>
<div class="paragraph">
<p>Quando si esamina la connettività, il costo potrebbe essere semplice da calcolare: dollari per Gigabyte trasferiti o il costo di router o strutture ottiche, ma il valore è difficile da quantificare, dal momento che è una esternalità. Un buon approccio è di considerarne il costo marginale e usarlo per compensare i benefici connessi con il cloud puro o ibrido.</p>
</div>
<div class="paragraph">
<p>E’ stato calcolato che una struttura ad hub rispetto ad una P2P ha un beneficio di
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mfrac>
      <mn>1</mn>
      <mi>n</mi>
    </mfrac>
  </mstyle>
</math>, dove n sta per il numero di connessioni. Ecco il grafico di questa funzione:</p>
</div>
<div id="img-function2" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/function2.png" alt="Andamento del beneficio di una struttura ad hub rispetto ad una P2P">
</div>
<div class="title">Figure 2. Andamento del beneficio di una struttura ad hub rispetto ad una P2P</div>
</div>
<div class="paragraph">
<p>Come si può notare notare, da un punto di vista prestazionale, il P2P conviene praticamente sempre, tranne nel caso in cui vi sia un solo nodo, ma per una maggiore facilità di gestione a volte si preferisce adoperare comunque una struttura centralizzata.
Utilizzando politiche smart all’interno di una infrastruttura di rete (il che significa non utilizzare algoritmi semplici come FCFS o Round Robin per il bilanciamento del carico, ma utilizzare metodi più intelligenti) porta a un miglioramento di
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mfrac>
      <mn>1</mn>
      <mn>2</mn>
    </mfrac>
    <mo>+</mo>
    <mfrac>
      <mn>1</mn>
      <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
      </mrow>
    </mfrac>
    <mo>-</mo>
    <msqrt>
      <mrow>
        <mfrac>
          <mi>&#x3C0;</mi>
          <mn>2</mn>
        </mfrac>
        <mi>n</mi>
      </mrow>
    </msqrt>
  </mstyle>
</math> dove n sta per il numero di path.
Ecco il grafico:</p>
</div>
<div id="img-function3" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/function3.png" alt="Andamento dei benefici che l'utilizzo di politiche smart porta all’interno di una infrastruttura di rete">
</div>
<div class="title">Figure 3. Andamento dei benefici che l&#8217;utilizzo di politiche smart porta all’interno di una infrastruttura di rete</div>
</div>
</div>
<div class="sect4">
<h5 id="_prezzi_vantaggiosi_em_u_em_tility_pricing">Prezzi vantaggiosi (<em>U</em>tility pricing)</h5>
<div class="paragraph">
<p>Con il cloud vi è la possibilità di pagare le risorse solo al momento dell’uso effettivo, con benefici apprezzabili soprattutto per gli ambienti con livelli di domanda variabile.</p>
</div>
<div class="paragraph">
<p>Il cloud, per definizione, è utile quando costa meno di realizzare un sistema privato o quando il carico di lavoro è molto variabile. Se il numero di richieste subisce molti sbalzi, infatti, significa che il sistema deve essere pronto a ricevere in ogni momento il picco più alto di traffico che potrebbe arrivare, mentre il cloud permette di richiedere le esatte risorse che servono in quel determinato momento, senza sprechi e pagando effettivamente solo per le risorse utilizzate.</p>
</div>
<div class="paragraph">
<p>Si consideri una richiesta di risorse variabile nel tempo e la si indichi con D(t) con
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mn>0</mn>
    <mo>&#x2264;</mo>
    <mi>t</mi>
    <mo>&#x2264;</mo>
    <mi>T</mi>
  </mstyle>
</math>. La richiesta di picco sarà dunque
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>P</mi>
    <mo>=</mo>
    <mo>max</mo>
    <mrow>
      <mo>{</mo>
      <mi>D</mi>
      <mrow>
        <mo>(</mo>
        <mi>t</mi>
        <mo>)</mo>
      </mrow>
      <mo>}</mo>
    </mrow>
  </mstyle>
</math>, mentre la domanda media sarà
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>A</mi>
    <mo>=</mo>
    <mi>&#x3BC;</mi>
    <mrow>
      <mo>{</mo>
      <mi>D</mi>
      <mrow>
        <mo>(</mo>
        <mi>t</mi>
        <mo>)</mo>
      </mrow>
      <mo>}</mo>
    </mrow>
  </mstyle>
</math>.
Sia il premio dell’utilità U il rapporto tra il costo per l’utilizzo di una unità del cloud e quello per l’utilizzo di un’unità dedicata. Ad esempio se si decide che si ha bisogno di una macchina, quest&#8217;ultima può essere comprata a rate (ad esempio per 300€ al mese) o affittata quando ci serve (ad esempio a 45€ al giorno). 300€ mensili al giorno vogliono dire circa 10€, quindi U = 4,5 (= 45€ / 10€). B sarà il costo di base per le risorse di proprietà.</p>
</div>
<div class="paragraph">
<p>Il prezzo per un utilizzo medio deve tenere in conto A, non P, quindi il costo totale per la richiesta di risorse D(t) sarà dato da A×U×B×T, che è il valore dell’integrale definito
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mrow>
      <msubsup>
        <mo>&#x222B;</mo>
        <mn>0</mn>
        <mi>T</mi>
      </msubsup>
    </mrow>
    <mi>U</mi>
    <mo>&#xD7;</mo>
    <mi>B</mi>
    <mo>&#xD7;</mo>
    <mi>D</mi>
    <mrow>
      <mo>(</mo>
      <mi>t</mi>
      <mo>)</mo>
    </mrow>
    <mrow>
      <mi>d</mi>
      <mi>t</mi>
    </mrow>
  </mstyle>
</math>. Per una soluzione con risorse proprietarie non esiste il concetto di pay-per-use, quindi il prezzo pagato sarà sempre quello riguardante la richiesta di picco, non quella media, quindi il prezzo totale sarà dato da P×B×T. Per avere un costo minore delle risorse on-demand rispetto a quelle proprietarie si deve avere
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>A</mi>
    <mo>&#xD7;</mo>
    <mi>U</mi>
    <mo>&#xD7;</mo>
    <mi>B</mi>
    <mo>&#xD7;</mo>
    <mi>T</mi>
    <mo>&lt;</mo>
    <mi>P</mi>
    <mo>&#xD7;</mo>
    <mi>B</mi>
    <mo>&#xD7;</mo>
    <mi>T</mi>
  </mstyle>
</math>. La B e la T si semplificano, portando alla soluzione che il cloud è più economico quando
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mfrac>
      <mi>P</mi>
      <mi>A</mi>
    </mfrac>
    <mo>&gt;</mo>
    <mi>U</mi>
  </mstyle>
</math>. Si deduce, dunque, che se il costo di un’unità del cloud è U volte più grande di quello di una risorsa dedicata, ma il rapporto tra la richiesta di picco e quella media è superiore ad U, una soluzione di tipo cloud sarà sempre meno costosa.</p>
</div>
</div>
<div class="sect4">
<h5 id="_risorse_on_em_d_em_emand">Risorse on-<em>D</em>emand</h5>
<div class="paragraph">
<p>Il valore dell’on-Demand consiste nell’avere sempre l’esatto numero di risorse di cui si ha bisogno in ogni momento e con il cloud si può raggiungere questo risultato. In base alla richiesta, infatti, si possono ottenere o rilasciare risorse dal cloud provider che si utilizza.</p>
</div>
<div class="paragraph">
<p>Si considerino i costi di penalizzazione associati all’insufficienza e all’eccesso di risorse. Se si indica con D la domanda e con R le risorse, il costo di penalizzazione è proporzionale a |D-R|. Se la domanda e le risorse sono tempo varianti, invece, il costo di penalizzazione è proporzionale a
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mo>&#x222B;</mo>
    <mrow>
      <mo>|</mo>
      <mi>D</mi>
      <mrow>
        <mo>(</mo>
        <mi>t</mi>
        <mo>)</mo>
      </mrow>
      <mo>-</mo>
      <mi>R</mi>
      <mrow>
        <mo>(</mo>
        <mi>t</mi>
        <mo>)</mo>
      </mrow>
      <mo>|</mo>
    </mrow>
    <mrow>
      <mi>d</mi>
      <mi>t</mi>
    </mrow>
  </mstyle>
</math>.</p>
</div>
<div class="paragraph">
<p>Se la domanda è costante, basta il resourcing tradizionale mentre, se non è lineare o se non è prevedibile, allora sorgono dei problemi e le risorse on-demand diventano indispensabili.</p>
</div>
<div class="paragraph">
<p>Si dimostra ora che la penalità del costo di un servizio centralizzato aumenta esponenzialmente con il tempo se la funzione della domanda è esponenziale.</p>
</div>
<div class="paragraph">
<p>Data una richiesta uniformemente distribuita da 0 a P, in un tempo T, con una penalità del costo del servizio di c, la penalità totale per risorse fissate, anche se si imposta il livello in modo ottimale, sarà
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mfrac>
      <mn>1</mn>
      <mn>6</mn>
    </mfrac>
    <mo>&#xD7;</mo>
    <mi>P</mi>
    <mo>&#xD7;</mo>
    <mi>T</mi>
    <mo>&#xD7;</mo>
    <mi>c</mi>
  </mstyle>
</math>.</p>
</div>
<div class="paragraph">
<p>Quando la funzione della domanda è esponenziale, ovvero
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>D</mi>
    <mrow>
      <mo>(</mo>
      <mi>t</mi>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <msup>
      <mi>e</mi>
      <mi>t</mi>
    </msup>
  </mstyle>
</math>, e l’intervallo di risorse fisso è k, le risorse saranno
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>R</mi>
    <mrow>
      <mo>(</mo>
      <mi>t</mi>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <msup>
      <mi>e</mi>
      <mrow>
        <mi>t</mi>
        <mo>-</mo>
        <mi>k</mi>
      </mrow>
    </msup>
  </mstyle>
</math>, quindi la penalità del costo del servizio sarà dato da
<math xmlns="http://www.w3.org/1998/Math/MathML">
  <mstyle displaystyle="true">
    <mi>D</mi>
    <mrow>
      <mo>(</mo>
      <mi>t</mi>
      <mo>)</mo>
    </mrow>
    <mo>-</mo>
    <mi>R</mi>
    <mrow>
      <mo>(</mo>
      <mi>t</mi>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <msup>
      <mi>e</mi>
      <mi>t</mi>
    </msup>
    <mo>-</mo>
    <msup>
      <mi>e</mi>
      <mrow>
        <mi>t</mi>
        <mo>-</mo>
        <mi>k</mi>
      </mrow>
    </msup>
    <mo>=</mo>
    <msup>
      <mi>e</mi>
      <mi>t</mi>
    </msup>
    <mrow>
      <mo>(</mo>
      <mn>1</mn>
      <mo>-</mo>
      <msup>
        <mi>e</mi>
        <mrow>
          <mo>-</mo>
          <mi>k</mi>
        </mrow>
      </msup>
      <mo>)</mo>
    </mrow>
  </mstyle>
</math>.</p>
</div>
<div class="paragraph">
<p>Come è possibile notare, ogni intervallo di risorse fisso che cerca di soddisfare la domanda in base al suo livello corrente ha una penalità del costo del servizio che cresce esponenzialmente con il tempo, quindi in presenza di una domanda che con andamento esponenziale non conviene utilizzare un servizio centralizzato.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_perchè_utilizzarlo">1.2.3. Perchè utilizzarlo</h4>
<div class="paragraph">
<p>Il cloud ormai fa parte della vita di tutti i giorni: da consumatori, si spende parte del tempo su social network basati sul cloud e
usando app scaricate dal cloud e, a livello lavorativo, si usano svariati programmi basati sul cloud.
I vantaggi legati al cloud e i motivi per cui le compagnie dovrebbero aggiornare i loro sistemi a questa tecnologia sono molteplici:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>riduzione dei costi;</p>
</li>
<li>
<p>incremento della “business agility”;</p>
</li>
<li>
<p>miglioramento dell’esperienza dell’utente, riducendo la latenza dei servizi interattivi;</p>
</li>
<li>
<p>aumento delle capacità computazionali, offrendo la possibilità di far cooperare insieme un numero di risorse “vicino all’infinito”.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bisogna però specificare che il cloud, come anche big data, social e IoT, diventa particolarmente efficace quando le compagnie lo utilizzano
 per ottenere vantaggi strategici.
Vi sono quattro principali modi mediante i quali le compagnie utilizzano il cloud:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Information excellence</dt>
<dd>
<p>Le aziende sfruttano le informazioni per ottimizzare dinamicamente la produzione, i servizi e
altri processi di business. L’analisi ha portato da sempre a un processo di miglioramento a lungo termine, a maggior ragione
in questo momento, in cui i dati sono accessibili in tempo reale e possono essere sottoposti ad algoritmi di analisi che
portano a una riduzione notevole dei costi;</p>
</dd>
<dt class="hdlist1">Solution leadership</dt>
<dd>
<p>Creazione di prodotti e servizi differenziati e collegati alla rete mediante servizi basati sul
cloud. Le macchine di ultima generazione o sistemi di monitoraggio di attività, sono alcuni degli esempi di questa nuova
generazione di soluzioni capace di interfacciarsi ad internet;</p>
</dd>
<dt class="hdlist1">Collective intimacy</dt>
<dd>
<p>Raccolta massiccia di dati degli utenti, in modo da estrapolarne preferenze e abitudini e per
fornire, quindi, delle raccomandazioni individuali mirate a ciascun cliente. Un esempio sono raccomandazioni di film o libri,
ma anche la generazione di terapie mediche per i pazienti basate sulle caratteristiche di ogni individuo e sui suoi sintomi;</p>
</dd>
<dt class="hdlist1">Accelerated innovation</dt>
<dd>
<p>L&#8217;insieme di tutti quei processi che consentono di portare avanti l’innovazione ancora più velocemente. Alcuni
esempi possono essere esperimenti a basso costo, crowdfunding e crowdsourcing.
Il cloud, inoltre, permette di far interagire tra di loro i dispositivi che fanno parte dell’IoT permettendo, ad esempio,
l’ottimizzazione delle smart city in modo da avere una sincronizzazione di scuola bus, ambulanze, ecc. <sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_aspetti_economici">1.2.4. Aspetti economici</h4>
<div class="paragraph">
<p>La crescita esplosiva del Cloud è dovuta ai benefici finanziari e strategici e la tariffazione pay-per-use è un attributo di base.
Qualcuno dice che la riduzione dei costi e la business agility sono i due più importanti benefici del Cloud, altri indicano
l’economia di scala dai grandi fornitori come principali benefici del cloud e altri prevedono che tutta l’IT si sposterà nel cloud.</p>
</div>
<div class="paragraph">
<p>Quando si considerano i costi di un sistema, non bisogna solamente guardare al costo delle unità, ma anche al loro utilizzo.
Se si usa solo il 33% di un sistema, significa che per ogni risorsa utilizzata ce ne sono 2 inutilizzate e il costo effettivo delle unità, dunque, triplica. Quando si considerano le unità, il prezzo è visibile nel loro costo, mentre quando si guarda all’utilizzo, un prezzo alto può essere causato da una scarsa gestione delle risorse, ma anche dall’inevitabile risultato di picchi di carichi di lavoro in presenza di capacità fissata.</p>
</div>
<div class="paragraph">
<p>Anche se il cloud teoricamente ottimizza i costi, ci sono alcune spese addizionali da tenere in conto:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La ricerca per trovare il giusto provider, anche se intermediari come broker possono aiutare;</p>
</li>
<li>
<p>Il costo per migrare le applicazioni a una architettura di tipo cloud se queste non sono state pensate fin dall’inizio per esso;</p>
</li>
<li>
<p>Costi di tipo tecnologico, come infrastrutture di rete, trasferimento dei dati o tool di gestione;</p>
</li>
<li>
<p>I costi di un&#8217;organizzazione che revisiona il servizio offerto dal provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Avere la giusta quantità di risorse per soddisfare le richieste ha un chiaro beneficio economico. Se vi sono troppe risorse, infatti, significa che parte del capitale usato per esse poteva essere investito diversamente o risparmiato mentre, se ve ne sono poche, l’applicazione funzionerà lentamente o non funzionerà del tutto. Se non si ha la possibilità di fare una stima di questa quantità è consigliabile affidarsi (anche parzialmente) al cloud pubblico che, mediante risorse su richiesta, garantisce sempre la giusta quantità di risorse.</p>
</div>
<div class="paragraph">
<p>Tuttavia, se l’andamento delle richieste è completamente piatto, non c’è un vero motivo per affidarsi a servizi on-demand, se non per non rimanere impreparati alla possibilità che questo andamento possa diventare esponenziale in futuro. In tal caso, infatti, affidarsi al cloud pubblico è vitale, poiché altrimenti alcune di queste richieste non saranno soddisfatte e, quindi, vi sarà una perdita economica.</p>
</div>
<div class="paragraph">
<p>Le infrastutture del cloud, tipicamente, sono geograficamente disperse per garantire una riduzione della latenza. Quest’ultima garantisce dei benefici in termini di business, infatti, tempi di caricamento minori implicano che più clienti possono visitare più pagine web e fare più acquisti o che gli impiegati possono essere più produttivi <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</sup>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_ibrido">1.2.5. Cloud ibrido</h4>
<div class="paragraph">
<p>La prospettiva economica di cloud privato o pubblico può essere semplificata nel seguente modo: il primo possiede risorse dedicate che sono proprietà dell’azienda che le utilizza e che richiedono un costo fisso indipendentemente da quante di queste risorse si stanno utilizzando, mentre il secondo ha delle risorse pronte all’uso, condivise anche con altre aziende e che vengono “affittate” all’occorrenza, quindi vi è un costo variabile in base a quanto le si utilizza. Per il cloud privato, dunque, vi sono delle risorse fisse, che sono quelle che l’azienda ha comprato e di cui si occupa di fare manutenzione, mentre per il cloud pubblico è possibile richiedere quante risorse servono, quindi si avrà una capacità variabile.</p>
</div>
<div class="paragraph">
<p>Qualsiasi mix di questi due approcci puri per andare incontro ai bisogni di una o più applicazioni può essere definito come architettura ibrida (Hybrid architecture).</p>
</div>
<div class="paragraph">
<p>Guardando anche ad altri settori si può notare che, sia il modello su cui si basa il cloud pubblico (a breve termine, su richiesta e con pagamento solo al momento dell’uso) sia quello su cui si basa il cloud privato (proprietà privata), esistono da moltissimo tempo ed hanno un grande successo a livello di business.</p>
</div>
<div class="paragraph">
<p>L’uomo, quindi, ha tratto i suoi vantaggi sia dall’uno sia dall’altro, dimostrando di non poter fare a meno di nessuno dei due: si immagini di non poter pagare un mutuo, di utilizzare solamente i mezzi pubblici, che tutte le luci degli appartamenti funzionassero solo ad energia solare, o ancora che non si potrebbero affittare stanze negli alberghi.</p>
</div>
<div class="paragraph">
<p>Quello che si fa in informatica, in questo caso, è quello che fa l’uomo tutti i giorni, ovvero prendere il meglio da entrambi i modelli pubblico e privato optando, quindi, per l’approccio ibrido.</p>
</div>
<div class="paragraph">
<p>In moltissimi settori gli approcci ibridi sono prevalenti, tra cui l’economia, l’ottimizzazione delle prestazioni o il comportamento umano.</p>
</div>
<div class="paragraph">
<p>In generale, in presenza di richieste variabili, le risorse ibride rappresentano un mix ottimale di un costo inferiore per le risorse dedicate che eseguono la parte di richieste costanti e per le risorse pay-per-use per la parte delle richieste variabili. Per richieste costanti si intendono quelle richieste che sono sempre presenti e che non dipendono da fattori esterni, mentre per richieste variabili si intendono quelle richieste che variano in modo imprevedibile.</p>
</div>
<div class="paragraph">
<p>L&#8217;approccio ottimale nella maggior parte dei casi, dunque, è utilizzare il cloud privato per le richieste che si presentano con costanza e che, quindi, sono prevedibili e utilizzare il cloud pubblico solamente nel caso di superamento della soglia di capacità del cloud privato, ovvero in presenza di richieste variabili.</p>
</div>
<div class="paragraph">
<p>Qualora i costi di uno dei due approcci dovessero abbassarsi, il cloud ibrido consentirebbe di espandersi verso l’approccio più economico, quindi vi è una flessibilità non indifferente. Investire tutti i propri investimenti in una propria infrastruttura, adottando quindi esclusivamente il modello del cloud privato, potrebbe rivelarsi una mossa totalmente errata se un domani i cloud provider abbassassero drasticamente il costo del cloud pubblico. D’altra parte, essere bloccato nel cloud pubblico potrebbe essere un problema nel caso in cui il proprio provider dovesse avere cali di perfomance, per esempio.</p>
</div>
<div class="paragraph">
<p>Lo spostamento di applicazioni da un ambiente privato al cloud pubblico può significare anche costi di migrazione, quindi è meglio adottare l’approccio ibrido fin da subito.</p>
</div>
<div class="paragraph">
<p>Una sottile differenza tra cloud pubblico e privato che viene spesso trascurata è quella delle prestazioni. Mentre il cloud pubblico offre numerose opzioni e configurazioni standard, il controllo finale sulle architetture fisiche si ha con le risorse di proprietà, che possono essere configurate con elementi infrastrutturali come memoria, core e svariate altre scelte che possono soddisfare esattamente le esigenze dell’applicazione. Un&#8217;architettura con elementi più costosi e adatti all’applicazione può offrire un migliore rapporto tra prestazioni e prezzo, ma si va incontro a una grossa perdita in termini di flessibilità.</p>
</div>
<div class="paragraph">
<p>Di seguito si analizzano gli scenari e le architetture in cui il cloud ibrido può essere impiegato.
Un ambiente di cloud computing ibrido comprende tipicamente risorse private, uno o più servizi di cloud pubblico ed i “load balancers”, bilanciatori di carico che instradano gli utenti alle risorse private o pubbliche.</p>
</div>
<div class="paragraph">
<p>In casi semplici, come la visualizzazione di pagine web statiche, i load balancers possono instradare gli utenti indifferentemente verso risorse private o pubbliche, altre volte il cloud può fungere da front-end e il data center aziendale da back-end o viceversa. Un esempio in cui il cloud funge da back-end e le risorse private da front-end potrebbe essere quello in cui gli ordini commerciali e le transazioni di un servizio di vendita vengono gestite all’interno del cloud privato, mentre il cloud pubblico si occupa del content delivery (distribuzione di contenuti) per un catalogo web-based e di contenere il database del catalogo.</p>
</div>
<div class="paragraph">
<p>Oltre al cloud nello spazio si può anche pensare al cloud nel tempo, anche se è una visione meno tradizionale. Vi sono quattro ibridi generici nel tempo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lo sviluppo e il test dell’applicazione viene fatto nel cloud pubblico mentre, una volta che viene realizzata, l&#8217;applicazione viene eseguita all’interno del cloud privato aziendale;</p>
</li>
<li>
<p>Nello scenario inverso al precedente, lo sviluppo e il test dell’applicazione viene fatto nel cloud privato o anche in un computer desktop o in una workstation mentre, quando l&#8217;applicazione è ultimata, viene spostata nel cloud pubblico;</p>
</li>
<li>
<p>L’applicazione viene sia sviluppata che eseguita su cloud privato, ma viene spostata nel cloud pubblico a causa di strategie economiche o di altra natura;</p>
</li>
<li>
<p>Nello scenario inverso al precedente, una società, magari una startup, basa la sua IT (tecnologia dell’informazione) inizialmente sul cloud pubblico e, una volta che raggiunge un certo potere economico decide di investire in un proprio data center, migrando le sue applicazioni nel cloud privato.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Molte combinazioni di tutti questi scenari si verificano continuamente sulla base dei requisiti di business.</p>
</div>
<div class="paragraph">
<p>Ad esempio, in un approccio che oggi è estremamente prevalente, diversi cloud provider pubblici integrano applicazioni o componenti nel data center aziendale, ad esempio la validazione di una carta di credito, un SaaS per il CRM (Customer relationship management), per la condivisione di documenti o per lo storage.</p>
</div>
<div class="paragraph">
<p>Idealmente la scelta di cloud pubblico, privato o ibrido dovrebbe essere completamente separata da quella dell’architettura dell’applicazione allo stesso modo di come, quando si compra una macchina, la scelta di affittarla, pagare in contanti o tramite rate non dovrebbe influenzare sulla scelta del modello della stessa.</p>
</div>
<div class="paragraph">
<p>I requisiti per attuare questa strategia sono semplici. L’applicazione dovrebbe essere distribuibile facilmente sia nel caso di cloud privato, pubblico o entrambi, senza riscrivere parti di codice e dovrebbero essere disponibili dei tool automatici di gestione per abilitare varie componenti dell’applicazione in modo da aumentare la scalabilità e spostare l’applicazione da cloud privato a pubblico e viceversa e per fornire dati chiave come le performance dell’applicazione e le differenze di costo, in modo da ottimizzare intelligentemente i due ambienti.</p>
</div>
<div class="paragraph">
<p>Dietro questi requisiti di alto livello vi sono tecnologie specifiche di migrazione di macchine virtuali, dischi rigidi virtuali, configurazione di gestione di reti private virtuali, sicurezza, ecc.
<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</sup></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mongodb">1.3. MongoDB</h3>
<div class="quoteblock">
<blockquote>
MongoDB è un database open-source, basato sui documenti e progettato per la facilità di sviluppo e scalabilità.
</blockquote>
<div class="attribution">
&#8212; https://docs.MongoDB.org/manual/
</div>
</div>
<div class="paragraph">
<p>MongoDB (da "hu<strong>mongo</strong>us", enorme) è il più popolare DBMS non relazionale, ovvero di tipo NoSQL. Esso, dunque, non presenta la struttura tradizionale basata su tabelle dei database relazionali, ma adotta dei documenti in stile JSON con schema dinamico, rendendo l&#8217;integrazione di dati di alcuni tipi di applicazioni più facile e veloce <sup class="footnoteref">[<a class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>. Basti pensare che il JSON è uno dei formati più utilizzati per l’invio di strutture su internet per cui, la maggior parte delle volte, è immediato prendere le informazioni da questi file e inserirli nel database.</p>
</div>
<div class="sect3">
<h4 id="_i_documenti">1.3.1. I documenti</h4>
<div class="paragraph">
<p>I documenti sono gli analoghi delle strutture dei linguaggi di programmazione che associano chiavi a valori. Strutture del genere sono ad esempio i dizionari, le hash table, ecc. Formalmente i documenti sono di tipo BSON, che è una rappresentazione binaria di JSON con informazioni sui tipi aggiuntive. Nei documenti, il valore di un campo può essere qualsiasi tipo di dato BSON, compresi anche altri documenti, array e array di documenti.</p>
</div>
<div class="paragraph">
<p>I documenti sono salvati nelle collection, che sono un gruppo di documenti correlati che hanno un set di indirizzi comuni. Se si vuole fare un confronto con la logica relazionale, le collection sono le analoghe delle tabelle, mentre i documenti sono analoghi alle righe, con la differenza che una collection non ha bisogno che i suoi documenti abbiano la stessa struttura.</p>
</div>
<div class="paragraph">
<p>Mentre in SQL si è abituati a incrociare i dati di più tabelle, in MongoDB le query selezionano documenti da una singola collection.
Questi ultimi hanno sempre un campo chiamato "_id", che deve essere unico e che funge da chiave primaria. Quando non viene specificato dall’utente, esso viene creato automaticamente. Gli sviluppatori di MongoDB consigliano di farlo generare automaticamente lasciando il campo vuoto se non vi sono esigenze particolari.</p>
</div>
<div class="paragraph">
<p>L&#8217;ordine dei documenti ritornati da una query non è definito se non si specifica una sort. Questo comportamento è simile al non ordinamento verticale di una tabella SQL.
Se si vuole fare un paragone tra i database non relazionali e quelli relazionali, in genere i database relazionali hanno più funzionalità di quelli non relazionali, però quelli non relazionali hanno più performance e scalabilità orizzontale, in quanto il database è distribuito su più server.</p>
</div>
<div class="paragraph">
<p>Rispetto alle tabelle, il modello Json da dei vantaggi in termini di agilità e flessibilità. Se nelle prime, infatti, c’è una definizione di uno schema rigido che può essere modificato con grande sforzo e modificando anche i preesistenti dati, in MongoDB vi sono i documenti che hanno uno schema dinamico, in cui la definizione della struttura della tabella viene specificata al momento dell’inserimento dei dati, quindi una modifica di una parte di questi dati si fa semplicemente mediante una update e non ha bisogno di stravolgere il resto della collection. Il modello dei dati, dunque, può evolvere facilmente senza il bisogno di modificare la base di dati ogni volta che si decide anche solo di aggiungere un campo ad una tabella. In questo modo ci si può adattare più velocemente ai cambiamenti dell’applicazione, in quanto la struttura dei dati non viene fatta per i dati in se stessi, ma per l’uso che se ne fa, ovvero in base allo schema di accesso ad essi.</p>
</div>
<div class="paragraph">
<p>Un altro vantaggio dei documenti sulle tabelle è la maggiore vicinanza con l’attuale orientamento della programmazione: gli oggetti. Salvare un oggetto in MongoDB è molto più semplice che salvarlo in delle tabelle, perché tutti i suoi attributi, che siano stringhe, array o persino altri oggetti, possono essere mappati direttamente in un documento JSON.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scalabilità">1.3.2. Scalabilità</h4>
<div class="paragraph">
<p>Per la scalabilità si utilizza l’approccio dello sharding, ovvero il processo di salvare i dati distribuendoli su più server. Prima, con il modello relazionale, lo sharding era a livello applicativo, quindi si dividevano i dati all’interno dei vari database, ma tutte le operazioni, sia di scrittura sia di lettura, erano guidate dalle applicazioni (normalmente si faceva un hashing oppure un range di una chiave di dati). Con i database non relazionali, invece, lo sharding è trasparente ed automatico. Quest&#8217;ultimo, in MongoDB, è realizzato mediante uno strato intermedio (posto tra l’applicazione e i vari server) che si occupa di distribuire le query. Esso funziona come una sorta di proxy e gira su dei query router, che possono sia essere messi su delle macchine a parte sia girare sulla macchina su cui risiede l’applicativo e, come si evince dall’immagine seguente, l’applicazione comunica con loro attraverso dei driver.</p>
</div>
<div id="img-MongoDB_scheme" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/MongoDB_scheme.jpg" alt="MongoDB scheme">
</div>
<div class="title">Figure 4. L&#8217;infrastruttura di MongoDB</div>
</div>
<div class="paragraph">
<p>I Query router fanno la ricerca in modo intelligente quindi, in base alla richiesta che si vuole fare, i query router cercheranno di capire dove sono i dati a cui si vuole accedere e faranno la richiesta solo agli shard interessati.
Il vantaggio della scalabilità orizzontale è quello di poter aggiungere o togliere il numero di server (anche detto shard) a seconda delle necessità. Questo approccio viene detto scale out, mentre quello che si fa con i database relazionali è lo scale up, ovvero l’upgrade dei server esistenti per aumentarne le prestazioni.</p>
</div>
<div class="paragraph">
<p>Uno dei vantaggi di MongoDB è il bilanciamento automatico dei dati, poichè il carico viene distribuito automaticamente in modo da non appesantire troppo alcuni server in particolare. Quando si aggiunge un altro server, quindi, questo non rimane vuoto, poichè i dati vengono ridistribuiti in modo da cercare un carico uniformato tra tutti i server e in modo che il nuovo server entri in funzione fin da subito. Se è vuoto, infatti, sul server non si possono fare operazioni di lettura, ma solo di scrittura, quindi è lecito considerare che questo nuovo server non verrà utilizzato molto di frequente e, quindi, l’upgrade tecnologico non sarà stato molto efficace. Cosa molto importante è che il bilanciamento automatico dei dati viene fatto senza fermare il servizio principale.</p>
</div>
</div>
<div class="sect3">
<h4 id="_disponibilità_del_servizio_e_affidabilità">1.3.3. Disponibilità del servizio e affidabilità</h4>
<div class="paragraph">
<p>MongoDB garantisce l’alta affidabilità, ovvero assicura la disponibilità del servizio durante varie tipologie di failure.
Per quanto riguarda il disaster recovery (che si verifica ad esempio quando viene aggiunto un nuovo shard), lo sviluppatore ha a disposizione due parametri:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">RTO (recovery time objective)</dt>
<dd>
<p>Periodo di tempo massimo accettabile per eseguire lo switch a un altro datacenter</p>
</dd>
<dt class="hdlist1">RPO (recovery point objective)</dt>
<dd>
<p>Massima quantità di dati che è possibile perdere durante l’operazione di disaster recovery</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In base al valore di questi parametri, MongoDB si comporterà di conseguenza, scegliendo che priorità dare all’operazione di disaster recovery rispetto al servizio normale.
La manutenzione, invece, che può essere rappresentata ad esempio da upgrade di hardware o software, può essere ordinaria o straordinaria e viene fatta senza interrompere il servizio.</p>
</div>
<div class="paragraph">
<p>L’affidabilità viene garantita attraverso il replica set, che si compone di un primary e più copie del primary, dette secondary, che vengono aggiornate mediante una replicazione asincrona. Normalmente l’applicazione legge e scrive dal primary e i secondary vengono usati per il backup e per arbitration, ovvero quel meccanismo attraverso il quale, nel caso in cui alcuni server subiscono danni (failure), MongoDB automaticamente eleggerà un nuovo primary tra i secondary sopravvissuti. Siccome l’elezione prevede che esista almeno il 50%+1 dei sopravvissuti, il numero dei server deve essere dispari quindi, se si vogliono usare meccanismi di backup, bisogna usare almeno 3 server. È anche possibile usare un server solo come arbitration, tenendolo vuoto.</p>
</div>
<div class="paragraph">
<p>La disponibilità del servizio è garantita anche quando vi sono le operazioni di manutenzione a cui si è accennato in precedenza, poichè in queste occasioni, mettendo il primary come secondary per poi spegnerlo, il servizio può essere garantito ugualmente, in quanto le operazioni di lettura e scrittura possono essere fatte sul nuovo primary temporaneo. Al termine delle operazioni di manutenzione, è possibile ripristinare il primary originario, aggiornando tutte le modifiche fatte.</p>
</div>
<div class="paragraph">
<p>La replicazione asincrona comporta che, in caso di failure del primary, alcuni dati potrebbero andare perduti. Questo accade quando il failure avviene dopo che questi ultimi vengono scritti e prima che si completi la replica su almeno un secondary. Se lo sviluppatore ritiene che certi dati della sua applicazione sono così importanti da non poter accettare questa eventualità, quando si fa una scrittura sul primary si può specificare su quanti server si vuole che questa scrittura sia fatta prima che l’applicazione riceva la conferma di operazione effettuata con successo. Ad esempio si può indicare che la conferma venga data quando la maggioranza dei nodi ha scritto il dato e in questo modo si è sicuri che in caso di failure del primary i dati risiederanno almeno sulla maggior parte dei secondary.
La replicazione asincrona comporta il vantaggio che i secondary possono essere adattati a vari tipi di utilizzo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>si possono usare semplicemente come backup per garantire l’alta disponibilità del servizio;</p>
</li>
<li>
<p>possono essere distribuiti più data center per gestire il disaster recovery;</p>
</li>
<li>
<p>possono essere usati per la gestione della manutenzione;</p>
</li>
<li>
<p>possono essere distribuiti sul territorio, creando un meccanismo di caching per diminuire la latenza. Questo tipo di utilizzo è importante soprattutto per i servizi che sono principalmente in lettura e hanno bassa scrittura. Mettendo i secondary più vicini (in termini di network) agli utenti, infatti, questi ultimi leggeranno i dati dal secondary a loro più vicino, quindi riceveranno una risposta in maniera più rapida e il primary sarà meno carico.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ad aumentare ancora di più la disponibilità del servizio si ha che il sistema operativo di MongoDB, di default, è di tipo Journaling (disabilitabile a richiesta), quindi anche in caso di crash della macchina non si perde nessun dato anche se non si è fatto un flush sui data file, perché vi è il file log Journaling del file system che permette di fare la recovery dei dati.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performance">1.3.4. Performance</h4>
<div class="paragraph">
<p>Si è già detto che MongoDB, rispetto ai database relazionali è caratterizzato da un aumento delle performance.
In particolare, questo miglioramento è dato dal fatto che mettere insieme nello stesso documento dati che, in un modello SQL, apparterrebbero a tabelle diverse elimina la necessità di fare join tra tabelle e andare a cercare i dati sparpagliati all’interno del disco (disk seek).
I dati che appartengono a uno stesso documento, infatti, saranno scritti in modo contiguo sul disco, proprio per il fatto di appartenere allo stesso documento, quindi le operazioni di lettura e scrittura, nel modello NoSQL, diventano operazioni sequenziali.
Per ovviare alla mancanza della possibilità dell’SQL di riunire i dati che si erano precedentemente spezzati in più tabelle mediante una join, in MongoDB vi è il meccanismo dell’embedding, che consiste nell’aggiungere sottodocumenti nei documenti master.</p>
</div>
</div>
<div class="sect3">
<h4 id="_durabilità_dell_informazione">1.3.5. Durabilità dell’informazione</h4>
<div class="paragraph">
<p>La Durabilità rappresenta la “D” delle “ACID”, le proprietà logiche che devono avere le transazioni nel database, e rappresenta la garanzia che i dati scritti resteranno nel database in modo permanente. Più i dati sono durabili, più i tempi di risposta sono lunghi, quindi bisogna trovare un compromesso tra durabilità e tempi di risposta in base all’importanza dei dati che si stanno salvando. La caratteristica della durabilità è pienamente personalizzabile in MongoDB, poichè il livello di durabilità può essere impostato mediante diversi metodi di scrittura:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unacknowledged</dt>
<dd>
<p>È il metodo più veloce di scrivere dati su MongoDB e ed è basato sul modello asincrono, in quanto consiste solo nel mandare la scrittura al demone mongod, senza aspettare la sua risposta. Dopo che si scrive, quindi, non si sa se la scrittura è andata a buon fine o meno. Questa modalità è utile quando i dati sono veramente poco critici, ad esempio nel caso di logging aggressivo in cui se si perde qualche attività non è rilevante oppure nell&#8217;operazione di raccolta di statistiche.</p>
</dd>
<dt class="hdlist1">Acknowledged</dt>
<dd>
<p>È il metodo abilitato di default e consiste nell’aspettare la risposta dopo la scrittura, che viene mandata solo dopo che il dato è stato scritto in memoria. Un&#8217;eventuale risposta positiva permette al driver di accorgersi di molti errori, come quelli di network o dovuti a chiavi duplicate, ma non garantisce che i dati siano stati salvati su disco. Infatti, se sul server di MongoDB si verifica un crash dopo aver mandato l’ack ma prima di avere trasferito i dati dalla memoria al disco, questi ultimi vengono persi, senza che chi ha effettuato la scrittura se ne accorga.</p>
</dd>
<dt class="hdlist1">Journalled</dt>
<dd>
<p>È il metodo che assicura che i dati siano stati scritti su disco in quanto, in questa modalità, il server risponde positivamente solo dopo che l&#8217;operazione viene fatta sul journal. MongoDB, infatti, utilizza il journaling del file system di default e quindi, anche se si verifica un crash nel server prima che il dato possa essere scritto su disco, se si ha ricevuto una risposta affermativa da MongoDB si ha la sicurezza che il dato si trova almeno sul journal e che quindi, al prossimo riavvio, i dati verranno recuperati dal journal e scritti definitivamente sul disco. All’interno dello statement vi è il parametro j che sta per journaling che, quando vale true, attiva il journaling mentre, quando vale false, lo disattiva. Questo parametro j si può passare statement per statement, quindi si può abilitare o disabilitare il journaling a seconda del tipo di dato da trattare. Per quanto riguarda i tempi di risposta, di default il contenuto del journal viene scritto su disco ogni 100 ms, mentre se si ha una write con l’opzione del journaling attivata, i 100 ms si riducono a 30, per abbassare i tempi di risposta. Da questo dato si deduce che se si specifica j:true per ogni write, il massimo throughput sarà di 1000/30 = 33.3 write al secondo.</p>
</dd>
<dt class="hdlist1">Fsynced</dt>
<dd>
<p>In questa modalità, MongoDB da una risposta positiva alla write solo dopo che il dato è stato scritto sul disco.</p>
</dd>
<dt class="hdlist1">Replica acknowledged</dt>
<dd>
<p>È un metodo che, a differenza degli altri, si applica a più server. All’interno del replica set, infatti, si può stabilire su quanti server i dati hanno bisogno di essere scritti prima di considerare la scrittura andata a buon fine e, se il numero di server è superiore a uno, vuol dire che si sta utilizzando il metodo di scrittura “Replica acknowledged”.
In questa modalità, infatti, non basterà scrivere i dati sul primary, ma la risposta positiva sarà data solo dopo aver scritto i dati anche su un certo numero di secondary decisi dallo sviluppatore.
Con gli altri metodi, le replicazioni dal primary ai secondary avvengono in maniera asincrona, in modo tale che il primary non risenta troppo di avere molti secondary, mentre con questo metodo bisogna aspettare anche la scrittura su un certo numero di secondary, perciò i tempi di risposta aumentano di molto. Tuttavia, utilizzare questo metodo in certi contesti è indispensabile.
In caso di failure del primary, infatti, se vi erano dei dati che erano sul primary e che non erano ancora stati replicati sui secondary, questi dati andranno persi con gli altri metodi, mentre con il Replica acknowledged si ha la sicurezza che questi siano già stati scritti, quindi si risolve il problema della replicazione asincrona.
Il parametro da passare in questo caso sarà getLastError w:n, dove n può essere:</p>
<div class="ulist">
<ul>
<li>
<p>il numero di nodi su cui voglio che il dato venga scritto prima di avere risposta</p>
</li>
<li>
<p>“majority”, indicando l’intenzione di aspettare che il dato sia scritto sulla maggioranza dei secondary, in modo tale che nel caso in cui si aggiungessero altri nodi non si debba manualmente aggiornare un numero statico</p>
</li>
<li>
<p>“all” per indicare che il dato deve essere scritto su tutti i secondary. Nei casi di distribuzione geografica spinta questo comportamento può avere un impatto notevole sulla velocità e la latenza di risposta <sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</sup>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_indicizzazione">1.3.6. Indicizzazione</h4>
<div class="paragraph">
<p>Gli indici sono il più grande fattore di miglioramento delle performance di un DB e, ovviamente, MongoDB non ne è sprovvisto. Essi, in MongoDB, sono gestiti mediante B-Tree e non binary tree, in quanto questi ultimi hanno il difetto di essere troppo profondi.</p>
</div>
<div class="paragraph">
<p>Nella struttura B-Tree ogni nodo dell’albero può contenere molteplici valori, che saranno sempre minori dei valori contenuti nel nodo successivo e maggiori di quelli del nodo precedente. Proprio per la proprietà dei B-tree di avere un&#8217;altezza dell’albero ridotta, viene fatto un numero di confronti molto basso, in modo da ottimizzare al massimo le operazioni con gli indici. In particolare, l’aggiunta di un nuovo elemento avviene sempre con una complessità computazionale pari a log(n).</p>
</div>
<div class="paragraph">
<p>Esistono anche gli indici composti, ovvero indici che usano più di un campo, anche tra tipi di campi diversi, come un campo normale e un array. A partire dagli indici composti, MongoDB crea anche degli indici parziali, quindi se si fa una query su un solo campo su cui era stato creato un indice composto verrà sfruttato un indice parziale, creato a partire da quello composto, per velocizzare l’operazione.</p>
</div>
<div class="paragraph">
<p>Si è già detto che in MongoDB i documenti possono avere struttura diversa all’interno della stessa collection. Nel caso in cui si abbiano dei documenti con un campo specifico con cardinalità molto bassa rispetto al numero dei documenti, creando un indice su questo campo il comportamento di default è di aggiungere comunque tutti i documenti all’interno dell’indice e, in quelli in cui il campo non esiste, esso viene aggiunto e messo a NULL. Questo porta a una dimensione dell’indice notevole o comunque non necessaria. Per questo motivo, in MongoDB esiste lo sparse index, che si può abilitare mediante l’opzione “sparse: true”, all’interno dell’istruzione per creare l’indice. Esso fa in modo che nell’indice vi siano solo i documenti che hanno quel campo, quindi è particolarmente consigliato per tutti i campi con cardinalità molto bassa, perché porta a una notevole riduzione dell’indice.</p>
</div>
<div class="paragraph">
<p>Ovviamente, come per i database relazionali, si possono creare anche degli indici unici tramite il parametro unique: true, in modo tale da garantire consistenza alla base di dati.
Inoltre, esistono molti indici particolari, che permettono di fare operazioni specifiche sui campi, come ad esempio:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Indici geografici</dt>
<dd>
<p>Permettono di definire le coordinate e il tipo di oggetto, come ad esempio punto, cerchio o poligono, che può essere specificato mediante un array di coppie di coordinate. Per creare un indice di questo tipo basterà specificare la dicitura “2dsphere” come tipo dell’indice al momento della sua definizione. Questo indice usa la notazione GeoJSON e vi sono degli operatori speciali di MongoDB che rendono particolarmente facili le operazioni con questi tipi di campi, come ad esempio “$near”, che trova tutti i documenti vicini a delle certe coordinate, “$maxDistance”, che serve a specificare la massima distanza rispetto a un punto e “$within”, che serve a trovare tutti i documenti all’interno di un poligono.</p>
</dd>
<dt class="hdlist1">indici testuali</dt>
<dd>
<p>Permettono di effettuare lo stemming, ovvero il processo di riduzione della forma flessa di una parola alla sua forma radice, o dare un peso per i campi indicizzati, quindi ad esempio si può mettere un peso maggiore al titolo di un articolo rispetto al corpo. Per creare un indice di questo tipo basterà specificare la dicitura “text” come tipo dell’indice al momento della sua definizione.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_ordinamento">1.3.7. Ordinamento</h4>
<div class="paragraph">
<p>Quando si crea un indice, si può specificare se ordinare gli elementi dell’indice in ordine ascendente o discendente, in modo tale che il risultato della query sarà già ordinato. Questa istruzione, inoltre, funziona anche sui campi di tipo array o su campi di sottodocumenti.</p>
</div>
<div class="paragraph">
<p>L’ordinamento ha poca importanza sugli indici singoli, perché con i B-tree posso sia leggere dal basso che dall’alto quindi, anche se l’indice su un campo è in un verso, presentare i dati in ordine inverso ha lo stesso costo. Il discorso cambia negli indici composti, dove bisogna specificare l’ordine per ogni campo e, in questa situazione, ordinare in maniera differente ha un costo notevole, in quanto bisogna eseguire delle operazioni di sort che possono essere anche molto pesanti.
Si possono, dunque, creare indici non solo quando bisogna ottimizzare le operazioni su un determinato campo, ma anche per evitare operazioni di ordinamento frequenti.</p>
</div>
<div class="paragraph">
<p>Quando si fanno le query solo su campi di cui esiste un indice, per ottenere il risultato non c’è bisogno di leggere i documenti, ma basta ritornare i valori che sono all’interno dell’indice per risolvere la query, quindi questa sarà molto più rapida rispetto a una query eseguita su campi di cui non esiste un indice. Questi tipi di query si chiamano “query su covered index” o “query index only” e permettono di aumentare a dismisura le performance del sistema perché, di fatto, evitano di eseguire letture su disco.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scelta_dell_implementazione_del_coap">2. Scelta dell&#8217;implementazione del CoAP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In questo capitolo si riporta tutto il percorso che ha portato alla scelta dell&#8217;implementazione del CoAP da utilizzare, analizzando svantaggi, vantaggi e codici creati per ogni implementazione studiata.</p>
</div>
<div class="paragraph">
<p>Inizialmente si è cercato un implementazione del CoAP in Java, ma in seguito a vari problemi incontrati durante lo sviluppo, è stato necessario cambiare direzione e orientarsi verso il CoAPthon, un’implementazione basata su python (come si evince dal nome), tramite la quale si è riusciti a raggiungere gli scopi prefissati.</p>
</div>
<div class="sect2">
<h3 id="_jcoap">2.1. jCoAP</h3>
<div class="paragraph">
<p>La prima implementazione java del CoAP che si è testata è stata jCoAP, un’ implementazione stabile ed abbastanza semplice da utilizzare. Per cominciare si è esaminato il codice del jCoAP <sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</sup> e, prendendo spunto da alcuni programmi di esempio(creati da Christian Lerche), si è riusciti ad ottenere una corretta comunicazione che rispecchiasse il paradigma client-server.</p>
</div>
<div class="paragraph">
<p>In prima fase, infatti, piuttosto che preoccuparsi del progetto nella sua interezza, ci si è  concentrati sulla realizzazione di un client e un server che comunicassero con il protocollo CoAP.</p>
</div>
<div class="paragraph">
<p>A titolo di esempio si è considerata la situazione in cui ci fosse un sensore di temperatura lato client che trasmette valori ad un server.</p>
</div>
<div class="sect3">
<h4 id="_server">2.1.1. Server</h4>
<div class="paragraph">
<p>Di seguito si riportano i 3 file che costituiscono il server.</p>
</div>
<div class="sect4">
<h5 id="_mycoapserver">MyCoapServer</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.nio.ByteBuffer;
import org.ws4d.coap.Constants;
import org.ws4d.coap.connection.BasicCoapChannelManager;
import org.ws4d.coap.interfaces.CoapChannelManager;
import org.ws4d.coap.interfaces.CoapMessage;
import org.ws4d.coap.interfaces.CoapRequest;
import org.ws4d.coap.interfaces.CoapServer;
import org.ws4d.coap.interfaces.CoapServerChannel;
import org.ws4d.coap.messages.CoapMediaType;
import org.ws4d.coap.messages.CoapResponseCode;

// Resta in ascolto sulla porta PORT e ogni volta che gli arriva un messaggio avvia un thread che si occupa di gestire i dati(un double) contenuti in esso

public class MyCoapServer implements CoapServer {
    private final int PORT = Constants.COAP_DEFAULT_PORT;
    static int counter = 0;

    public void work(MyCoapServer server) {
        System.out.println("Start CoAP Server on port " + PORT);
        CoapChannelManager channelManager = BasicCoapChannelManager.getInstance();
        channelManager.createServerListener(server, PORT);
    }

	@Override
	public CoapServer onAccept(CoapRequest request) {
		System.out.println("Accept connection...");
		return this;
	}

	@Override
	public void onRequest(CoapServerChannel channel, CoapRequest request) {
		System.out.println("Received message: " + request.toString());
		GestoreDato gd= new GestoreDato(ByteBuffer.wrap(request.getPayload()).getDouble()); //creo l'oggetto gd che si occuperà di fare le operazioni necessarie sul dato
		gd.start();
		CoapMessage response = channel.createResponse(request, CoapResponseCode.Content_205);
		response.setContentType(CoapMediaType.text_plain);
		channel.sendMessage(response);
	}

	@Override
	public void onSeparateResponseFailed(CoapServerChannel channel) {
		System.out.println("Separate response transmission failed.");

	}
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_gestoredato">GestoreDato</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class GestoreDato extends Thread {

	private double temperatura;

	GestoreDato(double temperatura){
		setTemperatura(temperatura);
	}

    void setTemperatura(double temperatura){
        this.temperatura=temperatura;
    }

	double getTemperatura(){
		return temperatura;
	}

	@Override
	public void run(){
		System.out.println(getTemperatura());
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_demoserver">DemoServer</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">//programma che lancia il server
public class DemoServer {

	public static void main(String[] args) {
		MyCoapServer server=new MyCoapServer();
		server.work(server);
	}

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client">2.1.2. Client</h4>
<div class="paragraph">
<p>Si riportano ora i 3 programmi del client</p>
</div>
<div class="sect4">
<h5 id="_mycoapclient">MyCoapClient</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.net.InetAddress;
import java.net.UnknownHostException;
import java.nio.ByteBuffer;

import org.ws4d.coap.Constants;
import org.ws4d.coap.connection.BasicCoapChannelManager;
import org.ws4d.coap.interfaces.CoapChannelManager;
import org.ws4d.coap.interfaces.CoapClient;
import org.ws4d.coap.interfaces.CoapClientChannel;
import org.ws4d.coap.interfaces.CoapRequest;
import org.ws4d.coap.interfaces.CoapResponse;
import org.ws4d.coap.messages.CoapRequestCode;



// Manda al server un double rilevato da Sensore s ogni SLEEP secondi

public class MyCoapClient implements CoapClient {

	private final int SLEEP=5000; //millisecondi che bisogna attendere tra una lettura del sensore e un'altra
    private String server_address;
    private final int PORT = Constants.COAP_DEFAULT_PORT;
    static int counter = 0;
    CoapChannelManager channelManager;
    CoapClientChannel clientChannel;

    void setServer_address(String address){
    	server_address=address;
    }

    public void work( MyCoapClient client ) {
        System.out.println("Start CoAP Client");
        client.channelManager = BasicCoapChannelManager.getInstance();
        client.runTestClient();
    }

    public void runTestClient(){
    	Sensore s=new Sensore();
		byte[] bytes = new byte[8]; //bytes da spedire al server, sono 8 perché devo mandare un double
    	try {
			while(true){
				clientChannel = channelManager.connect(this, InetAddress.getByName(server_address), PORT);
				CoapRequest coapRequest = clientChannel.createRequest(true, CoapRequestCode.POST);
			    ByteBuffer.wrap(bytes).putDouble(s.rilevaTemperatura()); //trasformo il double che rappresenta la temperatura in byte[]
				coapRequest.setPayload(bytes);
				clientChannel.sendMessage(coapRequest);
				System.out.println("Message sent");
				Thread.sleep(SLEEP);
			}

		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
    }

	@Override
	public void onConnectionFailed(CoapClientChannel channel, boolean notReachable, boolean resetByServer) {
		System.out.println("Connection Failed");
	}

	@Override
	public void onResponse(CoapClientChannel channel, CoapResponse response) {
		System.out.println("Received response");
		System.out.println(response.toString());
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_democlient">DemoClient</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DemoClient {

	public static void main(String[] args) {
		MyCoapClient client=new MyCoapClient();
		if (args.length != 0)
			client.setServer_address(args[0]);
		else
			client.setServer_address("127.0.0.1");
		client.work(client);
	}

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sensore">Sensore</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Sensore {
	public double rilevaTemperatura(){
		return Math.random()*100-50; //ritorna un double tra -50 e 50
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_motivazioni_dell_abbandono">2.1.3. Motivazioni dell&#8217;abbandono</h4>
<div class="paragraph">
<p>Una volta ottenuto il risultato precedente si è provato ad estendere il lavoro svolto, cercando di implementare uno dei requisiti fondamentali del progetto: il multicast.
Dopo svariati tentativi ci si è resi conto che il jCoAP (almeno fino all’ultima versione disponibile al momento in cui si scrive, che è quella del 12 giugno 2012) non implementa il multicast.
Nel codice, infatti, non era presente alcuna istruzione che permettesse l’istanza di socket di tipo multicast o meccasmi di join agli indirizzi IP riservati a questo fine.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_californium">2.2. Californium</h3>
<div class="paragraph">
<p>Come conseguenza al fatto che il jCoAP non soddisfava i requisiti del progetto si è stati obbligati a cercare una nuova implementazione del protocollo, così si è studiato il Californium <sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</sup>, l&#8217;implementazione più completa(e anche più complessa) del CoAP in java.</p>
</div>
<div class="paragraph">
<p>Anche in questo caso ci è posti subito l&#8217;obiettivo di realizzare client e server, cosa che si è rivelata più complicata del previsto, vista la grandezza del core del californium.</p>
</div>
<div class="paragraph">
<p>Successivamente, si è cercato di simulare una parte del comportamento del nostro sistema, non includendo il multicast. Si è creato(basandosi su codici di esempio), dunque, l&#8217;interruttore, il server e la lampadina. L&#8217;interruttore manda segnali al server e quest&#8217;ultimo li rimanda alla lampadina. Di seguito ne riportiamo il codice.</p>
</div>
<div class="sect3">
<h4 id="_interruttore">2.2.1. Interruttore</h4>
<div class="sect4">
<h5 id="_client_2">Client</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Interruttore {

    public static void main(String[] args) {
        Scanner interruttore= new Scanner(System.in);
        String segnale;
        while(true){
        	Request post = new Request(Code.PUT);
        	post.setURI("coap://127.0.0.1:4000/Listener");
        	segnale=interruttore.nextLine();
        	switch(segnale){
        	case "0":
        		post.setPayload("0");
        		break;
        	case "1":
        		post.setPayload("1");
        		break;
        	default:
        		System.out.println("immettere 1 o 0");
        		continue;
        	}
        	post.getOptions()
            .setContentFormat(MediaTypeRegistry.TEXT_PLAIN)
            .setAccept(MediaTypeRegistry.TEXT_PLAIN)
            .setIfNoneMatch(true);
            try {
    			String response = post.send().waitForResponse().getPayloadString();
    			System.out.println(response);
    		} catch (InterruptedException e) {
    			e.printStackTrace();
    		}

        }

    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_2">2.2.2. Server</h4>
<div class="sect4">
<h5 id="_server_3">Server</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package step1;

import static org.eclipse.californium.core.coap.CoAP.ResponseCode.BAD_REQUEST;
import static org.eclipse.californium.core.coap.CoAP.ResponseCode.CHANGED;

import org.eclipse.californium.core.CoapResource;
import org.eclipse.californium.core.CoapServer;
import org.eclipse.californium.core.coap.MediaTypeRegistry;
import org.eclipse.californium.core.coap.Request;
import org.eclipse.californium.core.coap.CoAP.Code;
import org.eclipse.californium.core.server.resources.CoapExchange;

public class Server {

	static Selector selector;

	public static void main(String[] args) {
        // binds on UDP port 5683
        CoapServer server = new CoapServer(4000);
        server.add(new HelloResource());
        server.start();
    }

    public static class HelloResource extends CoapResource {
        public HelloResource() {
            // resource identifier
            super("Listener");
            // set display name
            getAttributes().setTitle("Hello-World Resource");
        }

        @Override
        public void handleGET(CoapExchange exchange) {
            exchange.respond("Respond");
        }

        @Override
        public void handlePUT(CoapExchange exchange) {
            byte[] payload = exchange.getRequestPayload();
            String destination;
            try {
            	System.out.println("Richiesta PUT, SERVER");
                String value = new String(payload, "UTF-8");
                System.out.println(value);
                exchange.respond(CHANGED, value);
                //destination=selector.groupSelect();
                Request post = new Request(Code.PUT);
                post.setURI("coap://127.0.0.1:5683");
                post.setMulticast(true);
                post.setPayload(value);
                post.getOptions()
                .setContentFormat(MediaTypeRegistry.TEXT_PLAIN)
                .setAccept(MediaTypeRegistry.TEXT_PLAIN)
                .setIfNoneMatch(true);
                try {
        			String response = post.send().waitForResponse().getPayloadString();
        		} catch (InterruptedException e) {
        			e.printStackTrace();
        		}
            } catch (Exception e) {
                e.printStackTrace();
                exchange.respond(BAD_REQUEST, "Invalid String");
            }
        }
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_selector">Selector</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package step1;

import java.net.InetAddress;
import java.net.UnknownHostException;

//decide a quale sottogruppo mandare l'input
public class Selector {

	String group;

	String groupSelect(){
		setGroup("coap://localhost/Ricevitore");
		return group;
	}

	void setGroup(String s){
		group=s;
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lampadina">2.2.3. Lampadina</h4>
<div class="sect4">
<h5 id="_server_4">Server</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package step1;

import static org.eclipse.californium.core.coap.CoAP.ResponseCode.BAD_REQUEST;
import static org.eclipse.californium.core.coap.CoAP.ResponseCode.CHANGED;

import java.io.IOException;
import java.net.InetSocketAddress;

import org.eclipse.californium.core.CoapResource;
import org.eclipse.californium.core.CoapServer;
import org.eclipse.californium.core.network.CoAPEndpoint;
import org.eclipse.californium.core.network.Endpoint;
import org.eclipse.californium.core.network.config.NetworkConfig;
import org.eclipse.californium.core.server.resources.CoapExchange;

public class LServer {


	public static void main(String[] args) throws IOException {
        // binds on UDP port 5683
		//InetAddress addr = InetAddress.getByName("224.0.1.187");

		//MulticastSocket s=new MulticastSocket(5683);
		//s.joinGroup(addr);
		InetSocketAddress a=new InetSocketAddress("127.0.0.1",5683);
        CoapServer server = new CoapServer();
        Endpoint endpoint = new CoAPEndpoint(a, NetworkConfig.getStandard());
        server.addEndpoint(endpoint);
        server.add(new HelloResource());
        server.start();
    }

    public static class HelloResource extends CoapResource {
        public HelloResource() {
            // resource identifier
            super("Ricevitore");
            // set display name
            getAttributes().setTitle("Hello-World Resource");
        }

        @Override
        public void handleGET(CoapExchange exchange) {
            exchange.respond("Respond");
        }

        @Override
        public void handlePUT(CoapExchange exchange) {
            byte[] payload = exchange.getRequestPayload();
            try {
            	System.out.println("Richiesta PUT, LAMPADINA");
                String value = new String(payload, "UTF-8");
                System.out.println(value);
                exchange.respond(CHANGED, value);
            } catch (Exception e) {
                e.printStackTrace();
                exchange.respond(BAD_REQUEST, "Invalid String");
            }
        }
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_motivazioni_dell_abbandono_2">2.2.4. Motivazioni dell&#8217;abbandono</h4>
<div class="paragraph">
<p>Una volta arrivati a questo punto si è provato, come in precedenza, ad aggiungere il multicast, senza però alcun successo. Dopo un&#8217;attenta analisi del codice e svariati tentativi, infatti, abbiamo capito che neanche nel californium(almeno alla versione disponibile al momento in cui si scrive, ovvero la release 1.0.0-M2 <sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</sup>) è stata implementata questa feature. Siamo arrivati alla conclusione quindi che non esistono implementazioni del CoAP in Java che supportano il multicast.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_coapthon">2.3. CoAPthon</h3>
<div class="paragraph">
<p>A questo punto ci si è informati su tutte le implementazioni del CoAP, non solo su quelle realizzate in Java, e alla fine si è scelto di studiare il CoaPthon, perché tra le caratteristiche presentava in bella vista il supporto al multicast.</p>
</div>
<div class="paragraph">
<p>Una difficoltà che si è avuta inizialmente è stata quella di imparare un nuovo linguaggio di programmazione in quanto questa implementazione è realizzata in python, un linguaggio che non era stato studiato fino ad ora dall&#8217;autore della tesi. Fortunatamente esso si presenta fin da subito abbastanza user-friendly e non si riscontrano particolari ostacoli nell&#8217;impararne gli aspetti fondamentali.</p>
</div>
<div class="sect3">
<h4 id="_coapclient">2.3.1. CoAPclient</h4>
<div class="paragraph">
<p>All&#8217;interno del codice del CoAPthon subito si nota il file coapclient.py, un programma che quando viene eseguito permette di mandare richieste CoAP inserendo da terminale le informazioni necessarie, come l’operazione da compiere(GET, PUT, ecc.), il percorso della richiesta e il payload. Se ne apprezzano dunque l’intuitività e il meccanismo di black-box e si cerca un modo per adattarlo agli scopi del progetto.</p>
</div>
<div class="paragraph">
<p>Semplicemente vengono modificati gli argomenti presi in ingresso dal terminale, aggiungendo l&#8217;indirizzo del destinatario mediante l&#8217;opzione “-A”. In questo modo, per mandare una richiesta all&#8217;interno di un programma basterà chiedere al sistema operativo di lanciare una stringa sulla linea di comando. Avendo a disposizione questo strumento si è creato client e server partendo dalla base dei codici di esempio creati da Giacomo Tanganelli(lo sviluppatore principale del CoAPthon).</p>
</div>
</div>
<div class="sect3">
<h4 id="_errori_riscontrati_e_risoluzione">2.3.2. Errori riscontrati e risoluzione</h4>
<div class="paragraph">
<p>Una volta installate tutte le librerie necessarie si è riscontrato un errore all&#8217;interno del codice del file client/coap_protocol.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">logfile = DailyLogFile("CoAPthon_client.log", home + "/.coapthon/")</code></pre>
</div>
</div>
<div class="paragraph">
<p>e del file server/coap_protocol.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">logfile = DailyLogFile("CoAPthon_server.log", home + "/.coapthon/")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Queste istruzioni non permettono il corretto funzionamento su sistemi operativi windows(il sistema sul quale si stava lavorando in quel periodo), in quanto il percorso indicato non è lecito perché era stato pensato per linux. Pertanto si è modificato le due righe nel seguente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">logfile = DailyLogFile("CoAPthon_client.log", "/coapthon/")</code></pre>
</div>
</div>
<div class="paragraph">
<p>e</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">logfile = DailyLogFile("CoAPthon_client.log", "/coapthon/")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Come si può notare è stato eliminato il punto dal percorso. In questo modo la cartella creata non sarà nascosta, ma almeno il programma sarà multipiattaforma.
Una volta risolti questi problemi si è cercato di inserire lo scambio di richieste in multicast all&#8217;interno del programma. Per farlo abbiamo utilizzato le seguenti istruzioni, che servono ad abilitare il server all&#8217;ascolto di richieste multicast.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">server = CoAPServer(group, 5683)
reactor.listenMulticast(5683, server, listenMultiple=True)</code></pre>
</div>
</div>
<div class="paragraph">
<p>dove il costruttore di CoAPServer è:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def __init__(self, host, port, multicast=False):</code></pre>
</div>
</div>
<div class="paragraph">
<p>e “group” indica l&#8217;indirizzo IP multicast al quale il server presta ascolto.</p>
</div>
<div class="paragraph">
<p>Dopo varie prove si è riusciti a legare diversi server ad un unico indirizzo IP multicast e a mandare richieste di multicast dal client al gruppo di server. Questi ultimi ricevono il messaggio del client e rispondo correttamente, mentre il client nonostante riceva tutte le risposte alza un&#8217;eccezione:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>("Can't stop reactor that isn't running.") twisted.internet.error.ReactorNotRunning: Can't stop reactor that isn't running.)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dopo svariati tentativi per cercare di risolvere questo problema si è deciso di contattare tramite e-mail il programmatore del CoAPthon: Giacomo Tanganelli. Costui si è rivelata fin da subito una persona disponibilissima e ha spiegato che con più server in esecuzione, il client solleva questa eccezione in ricezione perché si aspetta solo un ack, in quanto manda la richiesta ad un solo indirizzo IP, ma siccome l&#8217;indirizzo è di tipo multicast il messaggio verrà ricevuto da più macchine, che risponderanno ognuna con il proprio ack. Il client, perciò, si ritroverà risposte in eccesso e per questo lancerà quella eccezione. Dai test eseguiti, comunque, non risulta che questo problema intacchi la stabilità e il corretto funzionamento del sistema.</p>
</div>
<div class="paragraph">
<p>Al momento della scrittura del programma l&#8217;ultima versione disponibile del coapthon era il coapthon 2, ma successivamente è uscita la versione 3, in cui questo errore potrebbe essere stato risolto.</p>
</div>
</div>
<div class="sect3">
<h4 id="_motivazioni_della_scelta">2.3.3. Motivazioni della scelta</h4>
<div class="paragraph">
<p>Concludendo, dunque, si è deciso di adottare il CoAPthon come implementazione del CoAP all&#8217;interno del progetto per i seguenti motivi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in seguito a vari test effettuati si è dimostrato molto stabile;</p>
</li>
<li>
<p>il coapclient ha una struttura black-box che rende semplicissimo inviare un messaggio in CoAP, cosa non riscontrata in nessun&#8217;altra delle implementazioni provate fino ad ora;</p>
</li>
<li>
<p>è presente il supporto al multicast</p>
</li>
<li>
<p>il progetto è open-source e ben mantenuto</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_il_sistema_sviluppato">3. Il sistema sviluppato</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dopo aver visto le basi teoriche delle tecnologie su cui si fonda il progetto, si illustra di seguito il sistema sviluppato, ponendo particolare attenzione allo scenario di riferimento, ai vincoli che esso impone, agli obiettivi del progetto, alla soluzione, ai requisiti, alle funzionalità e ad alcuni casi d&#8217;uso.</p>
</div>
<div class="sect2">
<h3 id="_scenario_di_riferimento">3.1. Scenario di riferimento</h3>
<div class="paragraph">
<p>Lo scenario di riferimento è quello di un insieme di reti vincolate, contenenti i dispositivi, che si interfacciano con la rete internet standard e gli utenti
che vogliono accedere ai dispositivi, come mostrato nella figura di seguito.</p>
</div>
<div id="img-scenario1" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/schema_scenario_1.png" alt="Rappresentazione dello scenario">
</div>
<div class="title">Figure 5. Rappresentazione dello scenario</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">I dispositivi</dt>
<dd>
<p>Sono sensori e attuatori collegati a un sistema embedded, che gli permette di comunicare con il mondo esterno. Si considerano tutti come dei nodi vincolati.</p>
</dd>
<dt class="hdlist1">Le reti vincolate</dt>
<dd>
<p>Sono rappresentate da qualunque ambiente in cui vi siano dei nodi vincolati.<br>
Come si è visto nella sezione 1.1.1, infatti, l’uso dei nodi vincolati spesso porta anche a vincoli sulle reti stesse, quindi, anche se una rete non ha vincoli, ma al suo interno contiene nodi vincolati, essa può essere considerata ugualmente come una rete vincolata.<br>
Alcuni esempi potrebbero essere:</p>
<div class="ulist">
<ul>
<li>
<p>smart home con le luci che si accendono in base all&#8217;ora del giorno e alla locazione dell&#8217;interruttore attivato</p>
</li>
<li>
<p>università in cui si registrano gli ingressi e le uscite degli studenti dai laboratori e le cui porte si aprono solo se gli studenti sono abilitati a passare</p>
</li>
<li>
<p>terreni agricoli con dei sensori che misurano la presenza di determinati insetticidi.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gli utenti</dt>
<dd>
<p>Persone che, mediante un client, vogliono accedere ai dispositivi attraverso la rete Internet o una rete intranet.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_vincoli_progettuali">3.1.1. Vincoli progettuali</h4>
<div class="paragraph">
<p>Visto lo scenario di riferimento, è possibile elencare i vari vincoli progettuali che esso impone:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la presenza di nodi vincolati, per tutte le problematiche descritte nel capitolo 1.1.1, impone l&#8217;utilizzo del protocollo CoAP, poiché quest&#8217;ultimo ottimizza l&#8217;utilizzo di questi tipi di dispositivi</p>
</li>
<li>
<p>la presenza di più utenti che vogliono personalizzare il servizio, registrando i propri dispositivi o i propri servizi, porta all&#8217;esigenza di salvare le credenziali di accesso per ogni utente</p>
</li>
<li>
<p>Il vincolo precedente implica l&#8217;impiego di una comunicazione sicura, in quanto non è possibile far viaggiare su internet i dati personali degli utenti in chiaro. Inoltre non tutti gli utenti vogliono condividere le informazioni riguardanti i propri dispositivi, quindi deve essere possibile criptare anche queste ultime</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_obiettivi">3.2. Obiettivi</h3>
<div class="paragraph">
<p>Il progetto nasce per realizzare un sistema che permetta agli utenti di comandare gli attuatori mediante regole e servizi specificati da loro stessi
e di leggere le misurazioni prodotte dai sensori.
Tali obiettivi si traducono nei seguenti obiettivi tecnologici:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>utillizare CoAP come protocollo di comunicazione nelle reti vincolate;</p>
</li>
<li>
<p>gestire l&#8217;aggregazione di più attuatori all&#8217;interno di gruppi multicast;</p>
</li>
<li>
<p>far accedere gli utenti ai dispositivi mediante il protocollo HTTP;</p>
</li>
<li>
<p>salvare i dati dell&#8217;applicazione all&#8217;interno di un database NoSQL, mantenendo i dati personali degli utenti in un database SQL;</p>
</li>
<li>
<p>gestire la creazione di gruppi di utenti e dispositivi.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_la_soluzione">3.3. La soluzione</h3>
<div class="sect3">
<h4 id="_schema">3.3.1. Schema</h4>
<div class="paragraph">
<p>S&#8217;illustra di seguito lo schema completo della soluzione sviluppata, spiegando quali sono stati i componenti che a mano a mano sono stati aggiunti e per quale motivo.</p>
</div>
<div class="sect4">
<h5 id="_schema_iniziale">Schema iniziale</h5>
<div class="paragraph">
<p>Il primo elemento che si è pensato di aggiungere allo scenario è un server remoto che salvasse tutti i dati che servono all&#8217;applicazione, le misurazioni effettuate dai sensori e che fasse gestire il controllo degli attuatori in modo semplificato. Gli utenti, dunque, possono leggere le misurazioni dei sensori e controllare gli attuatori mediante un&#8217;interfaccia offerta da questo server.</p>
</div>
<div class="paragraph">
<p>I sensori e gli attuatori, tuttavia, non possono interfacciarsi direttamente con il server remoto, in quanto è necessaria un&#8217;altra entità che gestisca ogni rete vincolata. Si è scelto, dunque, di aggiungere in ogni rete vincolata un server di frontiera, che per semplicità chiameremo "server CoAP". Il nome deriva dal fatto che questo server comunica mediante il protocollo CoAP con i dispositivi della rete vincolata, in modo da limitare gli effetti dei vincoli.</p>
</div>
<div class="paragraph">
<p>Lo schema della soluzione sviluppata, dunque, prevede che i dispositivi comunichino con il server CoAP della propria rete vincolata e che quest&#8217;ultimo comunichi con il server remoto in modo tale da mandare le misure dei sensori e fornire un&#8217;interfaccia per comandare i gruppi multicast di attuatori presenti nella propria sottorete.</p>
</div>
<div id="img-soluzione1" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/schema_soluzione_1.png" alt="Schema della prima soluzione sviluppata">
</div>
<div class="title">Figure 6. Schema della prima soluzione sviluppata</div>
</div>
</div>
<div class="sect4">
<h5 id="_schema_completo">Schema completo</h5>
<div class="paragraph">
<p>Lo schema appena illustrato ha il problema che il server remoto è troppo sovraccarico, in quanto deve ricevere sia le richieste dei server CoAP che quelle degli
utenti.</p>
</div>
<div class="paragraph">
<p>Si è pensato dunque di creare due server distinti e indipendenti: uno che ricevesse le richieste degli utenti e gestisse le richieste in uscita verso i server
CoAP e uno che, invece, ricevesse le richieste in entrata da questi ultimi. Facendo così, se si hanno a disposizione due macchine, ogni server può girare su una
macchina diversa, consentendo di avere un bilanciamento del carico di lavoro.</p>
</div>
<div class="paragraph">
<p>Questa organizzazione logica separa la necessità degli utenti di controllare gli attuatori e, quindi, di far partire richieste verso i server CoAP
dalla gestione dei dati mandati dai sensori che vanno opportunamente processati ed immagazzinati, cioè le richieste in entrata dei server CoAP.</p>
</div>
<div class="paragraph">
<p>Lo schema completo del sistema, dunque, è il seguente.</p>
</div>
<div id="img-soluzione2" class="imageblock" style="text-align: center">
<div class="content">
<img src="images/schema_soluzione_2.png" alt="Schema della soluzione sviluppata">
</div>
<div class="title">Figure 7. Schema della soluzione sviluppata</div>
</div>
<div class="paragraph">
<p>Come si può notare non ci sono frecce tra i due server perché non hanno bisogno di comunicare tra di loro, in quanto sono stati progettati in modo da essere indipendenti l&#8217;uno dall&#8217;altro, per evitare di aumentare la latenza del sistema. In ogni caso da un punto di vista logico il server viene considerato unico e sempre sotto il nome di "server remoto".</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gestione_della_sicurezza">3.3.2. Gestione della sicurezza</h4>
<div class="paragraph">
<p>Per gestire la sicurezza vengono usati gli algoritmi di crittografia RSA e AES. Le chiavi dell&#8217;algoritmo RSA possono essere a 1024 o a 2048 bit, mentre quelle dell&#8217;AES possono essere a 128 oppure, scaricando la Java Cryptography Extension (JCE), a 256 bit.</p>
</div>
<div class="paragraph">
<p>Il server espone la chiave pubblica RSA a tutti, infatti, dal client viene richiesta automaticamente quando se ne ha la necessità, come ad esempio quando bisogna registrarsi al sistema. L&#8217;amministratore del server può decidere in qualsiasi momento di cambiare la chiave pubblica, in quanto vi sono meccanismi, spiegati meglio nel capitolo successivo, che permettono di rilevare quando un client ha bloccato la chiave, ovvero quando la sta usando per mandare dei dati al server; quindi la chiave pubblica verrà cambiata solo quando tutti client avranno finito di eseguire le loro operazioni o quando la sessione con tutti i client sarà scaduta, escludendo così il pericolo che server e client utilizzino contemporaneamente chiavi diverse.</p>
</div>
<div class="paragraph">
<p>Se non esiste alcuna coppia di chiavi RSA, essa viene creata all&#8217;avvio, sia nel server sia nel client. La chiave AES, invece, è creata dal server al momento della registrazione dell&#8217;utente e viene inviata al client al momento del login criptandola con la sua chiave pubblica, in modo tale che solo il client, con la sua chiave privata, potrà decriptarla.
Siccome il client è stato realizzato con lo scopo di far connettere l&#8217;utente da quanti client volesse (non contemporaneamente) al momento del login se non è presente la chiave AES, ad esempio perché ci si sta connettendo per la prima volta da un client diverso da quello con cui ci si è registrati, essa viene richiesta e, se il login avviene con successo, il server manda la chiave, criptandola con la chiave pubblica del nuovo client, che viene mandata da quest&#8217;ultimo al momento del login.</p>
</div>
<div class="paragraph">
<p>Con questo sistema l&#8217;unico inconveniente è che non si può cambiare la chiave AES, perché il client ogni volta che trova una chiave AES nel suo file system riguardante quel determinato utente assume che sia corretta e la utilizza. Per fare in modo che si potesse cambiare la chiave AES si potevano scegliere altre due strade:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il server tiene traccia di tutti i client dai quali l&#8217;utente si era collegato, notificandoli se la chiave AES era stata modificata;</p>
</li>
<li>
<p>il server manda a ogni nuova sessione la chiave AES e non la cambia fin quando la sessione non è conclusa, a meno di mettersi d&#8217;accordo con il client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Questi due metodi sono abbastanza dispendiosi in termini di risorse, perché aggiungono complessità all&#8217;operazione di login, che è l&#8217;operazione che si esegue con più frequenza, quindi si è preferito scegliere la soluzione di non poter cambiare la password AES.</p>
</div>
<div class="paragraph">
<p>Le operazioni legate all&#8217;utente in se, quindi login, logout, eliminazione dell&#8217;account e registrazione, sono effettuate con l&#8217;algoritmo RSA, mentre tutte le altre operazioni, come l&#8217;inserimento di un nuovo dispositivo, la ricezione di misurazioni, eccetera, vengono criptate con la chiave simmetrica AES.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gerarchia_dei_gruppi">3.3.3. Gerarchia dei gruppi</h4>
<div class="paragraph">
<p>Una caratteristica fondamentale del sistema è l&#8217;organizzazione in gerarchie dei gruppi di utenti e dispositivi.</p>
</div>
<div class="sect4">
<h5 id="_gerarchia_dei_gruppi_di_utenti">Gerarchia dei gruppi di utenti</h5>
<div class="paragraph">
<p>La gerarchia dei gruppi di utenti si traduce in un&#8217;ereditarietà dei privilegi rispetto al gruppo padre.
Questo significa che un gruppo figlio ha tutti i privilegi del gruppo padre, ma può anche aggiungerne di nuovi.
Quando questo avviene, i nuovi privilegi saranno trasmessi anche ai suoi discendenti, ma non ai suoi antenati.</p>
</div>
<div class="paragraph">
<p>Un esempio potrebbe essere quello di un&#8217;università in cui si ha un gruppo di studenti che sono abilitati ad aprire le porte che conducono alle aule.
Se da questo gruppo viene creato un sottogruppo di tirocinanti che, oltre a seguire le lezioni di mattina, nel pomeriggio deve recarsi presso alcuni laboratori, gli utenti appartenenti al gruppo di tirocinanti saranno già abilitati ad aprire le porte che conducono alle aule e basterà aggiungere solo i permessi che i tirocinanti hanno in più rispetto agli studenti normali per completare la registrazione del nuovo gruppo, quindi non bisognerà riscrivere ogni volta, per ogni gruppo, dei permessi che sono già stati descritti per altri gruppi.</p>
</div>
<div class="paragraph">
<p>Se si vuole far appartenere il dispositivo a più gruppi di utenti che non appartengono alla stessa gerarchia, è possibile specificare più gruppi per utente.</p>
</div>
</div>
<div class="sect4">
<h5 id="_gerarchia_dei_gruppi_di_dispositivi">Gerarchia dei gruppi di dispositivi</h5>
<div class="paragraph">
<p>Grazie all&#8217;organizzazione di tipo gerarchica, risulta molto più semplice accedere ai dispositivi per gli utenti. Accedendo a un gruppo, infatti, verranno selezionati sia i dispositivi che appartengono a quel gruppo sia quelli che appartengono ai gruppi figli. Specificando la gerarchia, dunque, si potrà ottenere la condizione più semplice da gestire, ovvero quella in cui un dispositivo può appartenere solamente ad un gruppo, senza rinunciare alla possibilità di accedere a un dispositivo da più gruppi.</p>
</div>
<div class="paragraph">
<p>Se non ci fosse il meccanismo di gerarchia, dunque, se si volesse far appartenere un dispositivo a più gruppi, si dovrebbe aggiungere quel dispositivo a tutti questi gruppi mentre, se i gruppi in questione sono tutti legati da un rapporto di discendenza, basterà aggiungere il dispositivo nell&#8217;ultimo discendente.</p>
</div>
<div class="paragraph">
<p>Un esempio di gerarchia per i gruppi di dispositivi potrebbe essere quella di un palazzo in cui vi è una lampadina all&#8217;interno di una stanza e si vuole accedere a questa lampadina sia quando si vogliono controllare tutti dispositivi del palazzo, sia quelli del piano dove si trova la stanza, sia quelli della stanza. In questo caso basterà creare un gruppo relativo al palazzo, un gruppo relativo al piano e un gruppo relativo alla stanza, estendendoli nell&#8217;ordine in cui sono stati elencati. In questo modo, quando si accederà al gruppo del palazzo, tutti i dispositivi che sono in un gruppo in cui vi è come antenato il gruppo del palazzo e i dispositivi che appartengono al gruppo del palazzo verranno coinvolti nel servizio, inclusa la lampadina interessata.
Allo stesso modo, la lampadina sarà coinvolta quando si accederà sia al gruppo del piano sia a quello della stanza.</p>
</div>
<div class="paragraph">
<p>In ogni caso, se si volesse far appartenere il dispositivo a gruppi diversi che non sono legati tra di loro da rapporti di discendenza, ad esempio perché lo si vuole aggiungere a gruppi di altri utenti, è comunque possibile specificare più gruppi di appartenenza per dispositivo.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gestione_dei_tag">3.3.4. Gestione dei tag</h4>
<div class="paragraph">
<p>All&#8217;interno del sistema si è pensato di introdurre un concetto utilizzato recentemente, ad esempio nei social network, che consente di ottimizzare la ricerca
di servizi ed informazioni, ovvero i tag.
Mediante questo strumento, gli utenti possono etichettare qualsiasi dispositivo di loro proprietà, in modo tale da associarlo a un concetto particolare
(es., un&#8217;attività, una funzionalità, una posizione,&#8230;&#8203;).
Il sistema, dunque, permette di eseguire l&#8217;accesso ai dispositivi mediante queste parole chiave.</p>
</div>
<div class="paragraph">
<p>Durante lo sviluppo, tuttavia, una delle questioni che ha dato più da pensare è stata l&#8217;utilizzo simile che si fa di tag e gruppi. La funzione principale di entrambi gli elementi, infatti, è quella di permettere l&#8217;accesso a più dispositivi contemporaneamente sotto un unico nome logico, quindi si è pensato alle possibilità di unire questi due concetti o di lasciali separati.</p>
</div>
<div class="paragraph">
<p>La prima opzione consiste nel far coincidere i tag con i gruppi. Questi ultimi, dunque, sono creati mediante i tag che, a questo punto, rappresentano semplicemente i nomi dei gruppi. Nello specifico, nel momento in cui si aggiunge un tag a un dispositivo, per gli attuatori significa mettersi in ascolto all&#8217;indirizzo IP multicast del gruppo il cui nome corrisponde al tag, mentre per i sensori significa aggiungere il gruppo, il cui nome corrisponde al tag, nel documento di quel sensore nel database MongoDB.</p>
</div>
<div class="paragraph">
<p>Questo approccio ha sia lati positivi che lati negativi:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Pro</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>riduzione della complessità del progetto, in quanto tag e gruppi vengono gestiti come un&#8217;unica entità e non come due separate</p>
</li>
<li>
<p>quando si fa un accesso mediante tag a degli attuatori, si sa già a quali dispositivi mandare la richiesta in quanto, poiché un tag ha una corrispondenza 1 a 1 con un indirizzo IP multicast, non c&#8217;è bisogno di cercare quali attuatori hanno quel determinato tag, dunque si riduce la latenza.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Contro</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>se vi sono molti tag, un attuatore deve associarsi a molti indirizzi multicast perché ogni tag, di fatto, corrisponde a un gruppo</p>
</li>
<li>
<p>snaturamento del concetto di tag per evitare la perdita del sistema di gerarchie dei gruppi</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>La seconda possibilità è mantenere i tag e i gruppi separati, quindi specificare, per ogni dispositivo, sia i gruppi di cui fa parte sia i tag che gli sono stati assegnati. In questo caso, per accedere ai sensori mediante i tag, basterà fare una query su MongoDB per trovare tutti i sensori che contengono quel determinato tag, mentre per gli attuatori bisogna mandare il messaggio a tutti i gruppi multicast interessati. Una volta ricevuto il messaggio, se nel payload è specificato un tag, ogni attuatore controllerà se possiede quel tag e solo in caso affermativo il dispositivo eseguirà l&#8217;istruzione ricevuta.</p>
</div>
<div class="paragraph">
<p>Un tag all&#8217;interno di un attuatore con questo approccio, dunque, non si riferisce più a un gruppo, ma rappresenta un&#8217;etichetta che gli utenti danno per classificare i loro dispositivi.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Pro</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>utilizzo dei tag più classico</p>
</li>
<li>
<p>l&#8217;utente può creare quanti tag desidera senza inficiare sulle prestazioni del singolo attuatore, in quanto quest&#8217;ultimo sta in ascolto solamente dei gruppi</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Contro</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>ricerca dei tag piuttosto onerosa negli attuatori se va fatta su molti dispositivi, perché il messaggio deve essere mandato a tutti i gruppi su cui si desidera effettuare la ricerca del tag, quindi tutti i dispositivi riceveranno il messaggio per controllare se possiedono il tag o meno</p>
</li>
<li>
<p>gli utenti devono gestire sia i tag sia i gruppi, perché questi non sono più collegati, il che implica una maggiore complessità del sistema, sia a livello concettuale che a livello progettuale</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Tra i contro del primo approccio e i pro del secondo ve ne sono due che non sono stati commentati volutamente, perché rappresentano gli aspetti che, più di tutti, hanno fatto scegliere di adottare nel progetto la seconda opzione, dunque necessitano di un discorso più approfondito, che si affronterà qui di seguito.</p>
</div>
<div class="paragraph">
<p>Il pro a cui si fa riferimento è l&#8217;utilizzo dei tag più classico, mentre il contro è lo snaturamento del concetto di tag per evitare la perdita del sistema di gerarchie dei gruppi. Nei vari social network non si è mai visto che i tag fossero organizzati in maniera gerarchica, perché sarebbe molto complicato da gestire per l&#8217;utenza media. In questo progetto, tuttavia, la gerarchia dei gruppi, sia di dispositivi sia di utenti, è presente tra i requisiti, quindi non è qualcosa alla quale si può rinunciare e, se si vuole unire il concetto di tag a quello di gruppo, è inevitabile che si debba introdurre una gerarchia per i tag. Siccome l&#8217;utenza è abituata a usare i tag nella sua quotidianità ed ha ben chiaro in mente cosa rappresentano, si è ritenuto che pensare i tag in maniera gerarchica risulti più complicato di mantenere separati i concetti di tag e gruppi per l&#8217;utente medio, quindi si è deciso di adottare la seconda opzione.</p>
</div>
<div class="paragraph">
<p>In definitiva, i gruppi devono essere usati per tutti gli accessi che si fanno più frequentemente, mentre i tag per operazioni che si fanno molto raramente, in modo da non sovraccaricare il sistema durante le operazioni più frequenti (cosa che accade nel primo approccio, in quanto ogni attuatore sta in ascolto su tutti i tag) senza perdere la possibilità di attivare servizi particolari mediante i tag quando se ne ha la necessità.</p>
</div>
<div class="paragraph">
<p>In ogni caso per selezionare i gruppi in maniera smart, vi sono anche i tag per gruppi, chiamati "group tags", che consentono di selezionare tutti i gruppi che hanno dei determinati tag.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_requisiti">3.4. Requisiti</h3>
<div class="paragraph">
<p>La soluzione sviluppata prevede che ciascun componente del sistema risponda a determinati requisiti.</p>
</div>
<div class="sect3">
<h4 id="_utente">3.4.1. Utente</h4>
<div class="paragraph">
<p>L&#8217;utente deve potere eseguire le seguenti operazioni:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Gestione gruppi di utenti</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>creare gruppi di utenti</p>
</li>
<li>
<p>aggiungere altri utenti ai propri gruppi di utenti</p>
</li>
<li>
<p>rimuovere altri utenti dai propri gruppi di utenti</p>
</li>
<li>
<p>verificare a quali gruppi di utenti si appartiene</p>
</li>
<li>
<p>verificare quali altri utenti appartengono a un gruppo a cui si appartiene</p>
</li>
<li>
<p>uscire da un gruppo di utenti</p>
</li>
<li>
<p>avere accesso a tutti i dispositivi che sono accessibili a tutti i gruppi di utenti ai quali si fa parte</p>
</li>
<li>
<p>organizzare i propri gruppi di utenti con una gerarchia</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gestione della sicurezza dei dispositivi</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>rendere un proprio dispositivo <strong>privato</strong>: il dispositivo può essere aggiunto solo ai gruppi di dispositivi di possesso del proprietario del dispositivo e inoltre solo quest’ultimo può accedervi</p>
</li>
<li>
<p>rendere un proprio dispositivo ristretto solo ad alcuni gruppi di utenti: l’utente specifica quali gruppi di utenti possono accedere al proprio dispositivo</p>
</li>
<li>
<p>rendere un proprio dispositivo ristretto solo ad alcuni gruppi di dispositivi: l’utente specifica a quali gruppi di dispositivi può essere aggiunto il proprio dispositivo</p>
</li>
<li>
<p>rendere un proprio dispositivo ristretto solo ad alcuni gruppi di utenti e di dispositivi</p>
</li>
<li>
<p>rendere un proprio dispositivo <strong>pubblico</strong>: il dispositivo può essere aggiunto a qualsiasi gruppo di dispositivi e, inoltre, qualsiasi utente può accedere a quel dispositivo</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gestione della sicurezza generale</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Scambiare dati con il server remoto in maniera sicura e affidabile</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gestione dispositivi</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>registrare i propri dispositivi online</p>
</li>
<li>
<p>creare gruppi di dispositivi</p>
</li>
<li>
<p>aggiungere a un gruppo di cui si è il proprietario altri dispositivi di proprietà, pubblici o che hanno quel gruppo tra i gruppi ristretti</p>
</li>
<li>
<p>creare dei servizi personalizzati, installarli sui propri server e usarli in modo agevole</p>
</li>
<li>
<p>aggiungere e rimuovere tag ai propri dispositivi</p>
</li>
<li>
<p>accedere ai dispositivi mediante filtri come marca, tag, posizione e nome</p>
</li>
<li>
<p>organizzare i propri gruppi di dispositivi con una gerarchia</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gestione del proprio account</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>registrarsi al servizio specificando username, password ed email</p>
</li>
<li>
<p>eseguire il login mediante username e password</p>
</li>
<li>
<p>eseguire il logout</p>
</li>
<li>
<p>eliminare il proprio account</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_server_remoto">3.4.2. Server remoto</h4>
<div class="paragraph">
<p>Il server remoto deve implementare le seguenti funzionalità:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>salvare i dispositivi che vengono registrati dagli utenti;</p>
</li>
<li>
<p>scambiare dati in maniera sicura e affidabile con l&#8217;utente e i server CoAP</p>
</li>
<li>
<p>fornire dei mezzi per facilitare la creazione, l&#8217;installazione e l&#8217;utilizzo dei servizi personalizzati</p>
</li>
<li>
<p>funzionare da "ponte" tra utenti e server CoAP</p>
</li>
<li>
<p>non deve salvare informazioni personali nel cloud</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_server_coap">3.4.3. Server CoAP</h4>
<div class="paragraph">
<p>Il server CoAP deve implementare le seguenti funzionalità:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>installare ed utilizzare i servizi;</p>
</li>
<li>
<p>funzionare da "ponte" tra server remoto e dispositivi, mandando al server remoto le misurazioni dei sensori e mandando agli attuatori le richieste che provengono dal server remoto.</p>
</li>
<li>
<p>deve comunicare con il server remoto mediante HTTP e con i dispositivi con il protocollo CoAP</p>
</li>
<li>
<p>attivare i gruppi di attuatori in base alla locazione dell&#8217;interruttore attivato e all&#8217;orario, con regole stabilite dall&#8217;utente</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_dispositivi">3.4.4. Dispositivi</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Tutti i dispositivi</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Devono poter comunicare mediante il protocollo CoAP</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Sensori</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Nei sensori deve esserci la possibilità di impostare una soglia che stabilisca se la misurazione effettuata è significativa o meno.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Attuatori</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Devono potersi collegare a gruppi multicast</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_funzionalità">3.5. Funzionalità</h3>
<div class="paragraph">
<p>Oltre alle varie funzionalità descritte precedentemente, ve ne sono alcune più specifiche che sono spiegate qui di seguito.</p>
</div>
<div class="sect3">
<h4 id="_soglia_dei_sensori">3.5.1. Soglia dei sensori</h4>
<div class="paragraph">
<p>Per quanto riguarda i sensori si è pensato di introdurre una soglia, che stabilisce se la misura effettuata ha necessità di essere notificata al server oppure no. Ad esempio, per un sensore di temperatura nella maggior parte dei casi ha poco senso specificare che la temperatura è cambiata di 0,04 °C, quindi l&#8217;utente per evitare di intasare la propria sottorete e di salvare misure inutili, potrebbe impostare 0,1 come soglia per quel sensore, in modo tale da apprezzare solamente cambiamenti significativi della grandezza che si sta misurando, in quanto il sensore manderà una nuova misurazione solo se questa si discosterà di un valore superiore di 0,1 dalla misura inviata precedentemente.</p>
</div>
<div class="paragraph">
<p>Ogni volta che un sensore effettua una nuova misurazione, dunque, la confronta con quella precedente. Se la misurazione differirà da quella precedente di un valore superiore in valore assoluto alla soglia, allora la misurazione verrà ritenuta valida, quindi verrà mandata al server CoAP e sostituita con quella precedente per i futuri confronti.</p>
</div>
</div>
<div class="sect3">
<h4 id="_servizi_personalizzati">3.5.2. Servizi personalizzati</h4>
<div class="paragraph">
<p>Nel server CoAP è stato realizzato un database mysql, che registra le corrispondenze tra gruppi di attuatori, orari e le locazioni, in modo tale che se un interruttore di una determinata locazione viene attivato a una certa ora del giorno si attivavano o si disattivavano solo determinati gruppi.</p>
</div>
<div class="paragraph">
<p>Questa, tuttavia, è solo una delle svariate possibili funzioni che può avere questo sistema e si è pensato che in alcune situazioni potrebbe essere l&#8217;utente stesso a volerle sviluppare. Per questo motivo è stata data la possibilità di creare i servizi per i server CoAP al possessore del server stesso.</p>
</div>
<div class="paragraph">
<p>Nello specifico nel server CoAP viene creata una cartella nominata con il nome del servizio, all&#8217;interno della quale deve obbligatoriamente essere presente un programma nominato “main.py”, che è il programma che viene lanciato quando viene attivato il servizio. Oltre a questo possono essere presenti tutti gli altri file che sono necessari al servizio stesso, come ad esempio altri script python o i dati di cui ha bisogno il programma.</p>
</div>
<div class="paragraph">
<p>Il programma viene lanciato da remoto, mediante una POST (CoAP o HTTP), indicando nel payload il nome del servizio e i parametri che si vogliono passare ad esso. Questi ultimi verranno interpretati come parametri della linea di comando, quindi se il contenuto del payload è: “service1 parametro1 parametro2” nel coap server verrà lanciato il comando “main.py parametro1 parametro2”, dove main.py è contenuto nella cartella service1.</p>
</div>
<div class="paragraph">
<p>Registrare un nuovo servizio è semplicissimo, infatti basterà selezionare, mediante un&#8217;interfaccia grafica user friendly, la cartella nominata come il servizio, contenente tutti i file di cui esso necessita, compreso il file “main.py”, e indicare a quali server di propria proprietà si vuole inviare il servizio. Il client comprimerà la cartella e la invierà al server remoto, che si occuperà di smistare il contenuto del file zip ai vari server CoAP.</p>
</div>
<div class="paragraph">
<p>In fase di registrazione del servizio viene chiesto se lo si vuole rendere pubblico, ristretto solo ad alcuni gruppi di utenti o privato, ovvero accessibile solo dal proprietario del server.
Se si vuole che il servizio sia disponibile anche a dispositivi non dotati di autenticazione (ad esempio un interruttore comune), bisogna impostare il servizio come pubblico.</p>
</div>
<div class="paragraph">
<p>L&#8217;esempio fatto precedentemente sul contenuto del payload e dei parametri della linea di comando è inesatto in quanto, per semplicità, si è omesso un parametro che deve essere sempre presente, ovvero quello chiamato “actuators_groups”. Mediante questo parametro bisogna specificare la lista di gruppi di attuatori su cui si vuole attivare il servizio, specificandone il nome e l&#8217;utente che li possiede (se non è specificato si sottindende che siano di proprietà dell&#8217;utente che sta usando il servizio).</p>
</div>
<div class="paragraph">
<p>Il server remoto si occuperà di trovare gli ip dei gruppi di attuatori tra i gruppi degli utenti indicati e gli ip trovati verranno sostituiti ai nomi dei gruppi all&#8217;interno del parametro “actuators_groups”. Esso, inoltre, manderà la richiesta di servizio a tutti i server che contengono almeno uno dei gruppi di attuatori indicati. Il programma “main.py” del servizio specifico, dunque, sarà richiamato solo sui server che contengono almeno uno dei gruppi di attuatori indicati. Questi server, come parametri di linea di comando, si ritroveranno gli stessi parametri che chi ha richiesto il servizio ha mandato al server remoto, con la differenza che ora “actuators_groups” conterrà una lista degli indirizzi ip presenti nella sottorete di quel server, invece che i loro nomi. Ovviamente il server remoto, prima di distribuire le richieste di servizio ai vari server CoAP, farà le dovute verifiche per verificare che l&#8217;utente che richiede il servizio è abilitato a essere servito.</p>
</div>
<div class="paragraph">
<p>Un altro parametro speciale che viene fornito al servizio è quello dei tag, in quanto l&#8217;utente può attivare un servizio personalizzato solo sugli attuatori che hanno dei determinati tag. I tag inseriti dall&#8217;utente, dunque, verranno concatenati con delle virgole e si troveranno dopo la dicitura "tags:_" dopo gli ip dei gruppi di attuatori e prima degli altri parametri inseriti dall&#8217;utente.</p>
</div>
<div class="paragraph">
<p>Per fornire un esempio di come utilizzare i servizi, il comportamento degli orari e delle locazioni di prima viene trattato come se fosse un servizio, chiamato “green_activator” anche se, in realtà, per questioni di ottimizzazione, è impostato diversamente rispetto altri servizi.</p>
</div>
<div class="paragraph">
<p>A partire da questo esempio, dunque, potremmo introdurre una categoria di "servizi admin", che hanno le seguenti caratteristiche:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>possono essere aggiunti solamente dal codice sorgente del progetto stesso, quindi si possono fare delle operazioni di ottimizzazione</p>
</li>
<li>
<p>il modo in cui li si usa non deve essere diverso da quello dei servizi normali</p>
</li>
<li>
<p>se esiste un servizio utente nominato come il servizio admin, quando l&#8217;utente richiede il servizio con quel nome, viene attivato solo il servizio admin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;obiettivo, dunque, è quello di fornire alcuni servizi base di uso comune mediante i servizi admin e di lasciare la possibilità di sviluppare servizi personalizzati in base alle esigenze dell&#8217;utente mediante i servizi normali, che d&#8217;ora in poi verranno chiamati "servizi utente".</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_casi_d_uso">3.6. Casi d&#8217;uso</h3>
<div class="sect3">
<h4 id="_login">3.6.1. Login</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>L&#8217;utente richiede di autenticarsi inviando username e password</p>
</li>
<li>
<p>Il server invia le credenziali al database SQL</p>
</li>
<li>
<p>Il database SQL controlla se le credenziali corrispondono a un utente registrato al database e, se questo è vero, manda una risposta positiva</p>
</li>
<li>
<p>Il server manda una risposta positiva all&#8217;utente, che ora risulta autenticato</p>
</li>
</ol>
</div>
<div id="img-login" class="imageblock" style="text-align: center">
<div class="content">
<img src="diagrammi/login.png" alt="Sequence diagram del login">
</div>
<div class="title">Figure 8. Sequence diagram del login</div>
</div>
</div>
<div class="sect3">
<h4 id="_leggere_le_misurazioni_del_sensore">3.6.2. Leggere le misurazioni del sensore</h4>
<div class="paragraph">
<p>Condizioni iniziali: l&#8217;utente ha già effettuato il login.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>L’utente manda al server il nome del sensore di cui vuole sapere le misurazioni</p>
</li>
<li>
<p>il server legge le misurazioni nel database e le manda all&#8217;utente</p>
</li>
</ol>
</div>
<div id="img-misurazioni" class="imageblock" style="text-align: center">
<div class="content">
<img src="diagrammi/richiesta_misurazioni.png" alt="Sequence diagram della richiesta delle misurazioni">
</div>
<div class="title">Figure 9. Sequence diagram della richiesta delle misurazioni</div>
</div>
</div>
<div class="sect3">
<h4 id="_attivare_un_servizio_su_un_gruppo_di_attuatori">3.6.3. Attivare un servizio su un gruppo di attuatori</h4>
<div class="paragraph">
<p>Condizioni iniziali: l&#8217;utente ha già effettuato il login.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>L&#8217;utente manda al server remoto quale servizio vuole attivare, su quale gruppo di attuatori vuole attivarlo, specificando anche i corrispettivi proprietari dei gruppi, nel caso in cui essi non fossero di sua appartenenza</p>
</li>
<li>
<p>Il server remoto chiede al database a quali server CoAP appartengono i gruppi di attuatori che si vuole controllare e gli IP dei gruppi di attuatori</p>
</li>
<li>
<p>Il server invia ad ogni server CoAP trovato il nome del servizio e gli IP dei gruppi di attuatori presenti nella sua sottorete su cui attivare il servizio</p>
</li>
<li>
<p>Ogni server CoAP esegue le istruzioni del servizio, inviando i relativi comandi agli ip specificati dal server remoto.</p>
</li>
</ol>
</div>
<div id="img-servizi" class="imageblock" style="text-align: center">
<div class="content">
<img src="diagrammi/attivazione_servizi.png" alt="Sequence diagram dell'attivazione dei servizi">
</div>
<div class="title">Figure 10. Sequence diagram dell&#8217;attivazione dei servizi</div>
</div>
</div>
<div class="sect3">
<h4 id="_inserimento_di_un_nuovo_sensore">3.6.4. Inserimento di un nuovo sensore</h4>
<div class="paragraph">
<p>Condizioni iniziali: l&#8217;utente ha già effettuato il login.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>L&#8217;utente inserisce nel sensore il suo id, la sua soglia e specifica il server CoAP al quale vuole inviare i dati;</p>
</li>
<li>
<p>L&#8217;utente registra il sensore nel server remoto, specificando tutte le sue caratteristiche.</p>
</li>
<li>
<p>Il server remoto controlla se non è già stato registrato un sensore con lo stesso nome da parte dello stesso utente e, nel caso in cui il nome sia disponibile, da una risposta positiva al client</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="diagrammi/inserimento_sensore.png" alt="Sequence diagram dell'inserimento di un nuovo sensore">
</div>
<div class="title">Figure 11. Sequence diagram dell&#8217;inserimento di un nuovo sensore</div>
</div>
</div>
<div class="sect3">
<h4 id="_inserimento_di_un_nuovo_attuatore">3.6.5. Inserimento di un nuovo attuatore</h4>
<div class="paragraph">
<p>Condizioni iniziali: l&#8217;utente ha già effettuato il login.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>L&#8217;utente inserisce nell&#8217;attuatore i suoi tag e i gruppi multicast al quale l&#8217;attuatore appartiene</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="diagrammi/inserimento_attuatore.png" alt="Sequence diagram dell'inserimento di un nuovo attuatore">
</div>
<div class="title">Figure 12. Sequence diagram dell&#8217;inserimento di un nuovo attuatore</div>
</div>
<div class="paragraph">
<p>Si noti che il server remoto non tiene traccia dei singoli attuatori in quanto il multicast ci permette di creare una astrazione e di trattarli, insieme, come gruppi.</p>
</div>
</div>
<div class="sect3">
<h4 id="_inserimento_di_una_misurazione">3.6.6. Inserimento di una misurazione</h4>
<div class="paragraph">
<p>Condizioni iniziali: l&#8217;utente ha già effettuato il login.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Il sensore effettua una misurazione</p>
</li>
<li>
<p>Il sensore confronta la misurazione effettuata con la misurazione valida precedente e se questa differisce da quest&#8217;ultima di un valore superiore in valore assoluto alla soglia, allora la misurazione verrà ritenuta valida</p>
</li>
<li>
<p>Se la misurazione è ritenuta valida, il sensore la manda al server CoAP e la sostituisce alla misurazione valida precedente per i futuri confronti</p>
</li>
<li>
<p>Il server CoAP manda la misurazione al server remoto, indicando anche l&#8217;id del sensore che l&#8217;ha effettuata</p>
</li>
<li>
<p>Il server remoto salva la misurazione ricevuta, insieme all&#8217;id del sensore e a un timestamp.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="diagrammi/inserimento_misura.png" alt="Sequence diagram dell'inserimento di una nuova misura">
</div>
<div class="title">Figure 13. Sequence diagram dell&#8217;inserimento di una nuova misura</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dettagli_implementativi">4. Dettagli implementativi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dopo aver spiegato il funzionamento del sistema nel capitolo precedente, si illustrano di seguito i dettagli implementativi.</p>
</div>
<div class="sect2">
<h3 id="_linguaggi_di_programmazione">4.1. Linguaggi di Programmazione</h3>
<div class="paragraph">
<p>E' stato utilizzato java nella versione 8 per le parti che riguardano il client, il server remoto e MongoDB (in quanto, per interfacciarsi con quest&#8217;ultimo, è stato utilizzato il driver java), mentre per il CoAP server, gli interruttori, i sensori e gli attuatori è stato utilizzato python 2.7.</p>
</div>
<div class="paragraph">
<p>La scelta della versione di python è stata forzata, in quanto il CoAPthon è basato su di essa.</p>
</div>
<div class="paragraph">
<p>Come regole di indentazione del codice si sono seguiti gli standard di default di eclipse mars, ovvero 120 caratteri massimi per riga per il codice e 80 per i commenti.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gruppi">4.2. Gruppi</h3>
<div class="sect3">
<h4 id="_gestione_della_gerarchia">4.2.1. Gestione della gerarchia</h4>
<div class="paragraph">
<p>Tra i vari metodi elencati nella documentazione di MongoDB per gestire gli alberi, si è scelto la struttura con materialized paths. Con questa struttura ogni nodo dell&#8217;albero viene salvato in un documento e, nello stesso documento, viene salvato il suo percorso all&#8217;interno dell&#8217;albero, ovvero gli id degli altri nodi genitori in modo ordinato.</p>
</div>
<div class="paragraph">
<p>Esempio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{ _id: "gruppo1", path: null }
{ _id: "gruppo2", path: ",gruppo1," }
{ _id: "gruppo3", path: ",gruppo1,gruppo2," }
{ _id: "gruppo4", path: ",gruppo1,gruppo2," }
{ _id: "gruppo5", path: ",gruppo1,gruppo2,gruppo3," }
{ _id: "gruppo6", path: ",gruppo1,gruppo2,gruppo3," }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Questi documenti rappresentano la seguente struttura:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/esempio_gerarchia.png" alt="Esempio di gerarchia dei gruppi">
</div>
<div class="title">Figure 14. Esempio di gerarchia dei gruppi</div>
</div>
<div class="paragraph">
<p>Si è scelta questa struttura per caratterizzare tutte le collection dei gruppi del progetto perché consente di avere la struttura ad albero con cui si è scelto di organizzare i gruppi per instaurare una gerarchia tra di essi già salvata all’interno del documento.</p>
</div>
<div class="paragraph">
<p>Un&#8217;altra possibilità che è stata presa in considerazione è quella della referenza al padre in cui, per ogni nodo dell&#8217;albero, viene salvato solamente il suo nodo genitore piuttosto che tutto il suo percorso fino al nodo root. Questo sistema permette di risparmiare in termini di spazio occupato, ma va ad inficiare negativamente sulla complessità computazionale in modo non indifferente. Per gestire query come “trovare tutti i figli di un certo nodo” e non fare troppi accessi su disco per interrogare il DB è necessario creare e mantenere aggiornata una struttura dinamica in memoria, quindi per diminuire sia la complessità computazionale che quella del progetto in se, si è deciso di evitare questa struttura in favore di quella con riferimento al path completo “materializzato” nel DB stesso. Inoltre, creando un indice sul path query come quella descritta precedentemente si risolvono in tempi molto brevi grazie all&#8217;indicizzazione di MongoDB, in quanto in ogni documento è scritto ogni predecessore di quel nodo.</p>
</div>
<div class="paragraph">
<p>Per comprendere meglio questo tipo di struttura si riporta di seguito il codiche della funzione InserGroup, presente all&#8217;interno della classe DBManager e tutte le funzioni più importanti che essa richiama. Questa funzione, come si intuisce dal titolo, consente di inserire un gruppo all&#8217;interno del database MongoDB.</p>
</div>
<div class="sect4">
<h5 id="_inserimento_di_un_gruppo">Inserimento di un gruppo</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public Boolean insertGroup(GenericalGroup gg) {
	Document doc = new Document(DatabaseDefines.GROUP_ADMIN, getUserId(gg.getAdmin())).append(DatabaseDefines.NAME, gg.getName());
	if (gg.isPublic())
		doc.append(DatabaseDefines.IS_PUBLIC, true);
	else
		doc.append(DatabaseDefines.IS_PUBLIC, false);
	if (gg.getDescription() != null) {
		doc.append(DatabaseDefines.GROUP_DESCRIPTION, gg.getDescription());
	}
	if (gg.getTags().size() &gt; 0)
		doc.append(DatabaseDefines.TAGS, gg.getTags());
	try {
		if (gg instanceof SensorsGroup) {
			SensorsGroup sg = (SensorsGroup) gg;
			if (sg.getPath() == null) {
				assignGroupPath(sg, DatabaseDefines.SENSORS_GROUP_COLLECTION);
			}
			doc.append(DatabaseDefines.PATH, sg.getPath());
			if (sg.getSensors() != null)
				doc.append(DatabaseDefines.SENSORS, getSensorsId(sg.getSensors()));
			db.getCollection(DatabaseDefines.SENSORS_GROUP_COLLECTION).insertOne(doc);
		} else if (gg instanceof UsersGroup) {
			UsersGroup ug = (UsersGroup) gg;
			if (ug.getPath() == null) {
				assignGroupPath(ug, DatabaseDefines.USERS_GROUP_COLLECTION);
			}
			doc.append(DatabaseDefines.PATH, ug.getPath());
			if (ug.getUsers() != null)
				doc.append(DatabaseDefines.USERS, ug.getUsers());
			db.getCollection(DatabaseDefines.USERS_GROUP_COLLECTION).insertOne(doc);
		} else {
			ActuatorsGroup ag = (ActuatorsGroup) gg;
			if (ag.getPath() == null) {
				assignGroupPath(ag, DatabaseDefines.ACTUATORS_GROUP_COLLECTION);
			}
			doc.append(DatabaseDefines.PATH, ag.getPath());
			if (ag.getIp() != null) {
				doc.append(DatabaseDefines.ACTUATORS_GROUP_IP, ag.getIp());
				doc.append(DatabaseDefines.SERVER_IP_PORT, ag.getServer().getIpPort());
			}
			db.getCollection(DatabaseDefines.ACTUATORS_GROUP_COLLECTION).insertOne(doc);
		}
	} catch (Exception e) {
		e.printStackTrace();
		return false;
	}
	return true;
}

public void assignGroupPath(GenericalGroup gg, String collection) {
	if (gg.getParentGroupName() == null) {
		gg.setPath(",");
	} else {
		String parentGroupPath = findParentGroupPath(gg, collection);
		if (parentGroupPath == null) {
			System.err.println("parent group does not exists, the group will be saved as root");
			gg.setPath(",");
		} else {
			String path = parentGroupPath + gg.getParentGroupName() + ",";
			gg.setPath(path);
		}
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gruppi_di_attuatori">4.2.2. Gruppi di attuatori</h4>
<div class="paragraph">
<p>Quando si inserisce un gruppo di attuatori vengono chiesti anche l&#8217;ip e la porta del server di appartenenza del gruppo, in modo tale che il server remoto sappia come raggiungere il gruppo.</p>
</div>
<div class="paragraph">
<p>In ogni caso, per un gruppo di attuatori l&#8217;IP e il server possono essere NULL perché, in questo caso, si sta esplicitando un gruppo logico, ovvero un gruppo che serve unicamente per avere altri gruppi figli, in modo da richiamarli contemporaneamente quando l&#8217;utente si riferisca a questo gruppo logico.</p>
</div>
<div class="paragraph">
<p>I gruppi, inoltre, possono avere sia IP e server specificati sia avere dei gruppi figli. In tal caso, infatti, la richiesta di servizio verrà inviata sia all&#8217;IP del gruppo padre sia all&#8217;IP dei gruppi figli.
Per la gestione della sicurezza, nel documento degli actuators group viene salvato il campo “allowed users groups”, in modo tale da specificare i gruppi di utenti che sono abilitati ad accedere a quel gruppo. Questo ovviamente ha effetto solo se il gruppo non è pubblico.</p>
</div>
<div class="paragraph">
<p>Per far capire meglio questi concetti viene riportata la parte di codice che si occupa di attivare un servizio, da quando viene presa in carico la richiesta da parte del server a quando viene mandata ai server CoAP.</p>
</div>
<div class="sect4">
<h5 id="_attivazione_di_un_servizio">Attivazione di un servizio</h5>
<div class="paragraph">
<p>funzione all&#8217;interno di DBManager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public Vector&lt;ActuatorsGroup&gt; getDescendantsActuatorsGroup(ActuatorsGroup group) {
  Document find_conditions = new Document(DatabaseDefines.GROUP_ADMIN, group.getAdmin())
      .append(DatabaseDefines.PATH, Pattern.compile("," + group.getName() + ","));
  Vector&lt;ActuatorsGroup&gt; descendants = new Vector&lt;ActuatorsGroup&gt;();
  MongoCursor&lt;Document&gt; cursor = db.getCollection(DatabaseDefines.ACTUATORS_GROUP_COLLECTION)
      .find(find_conditions).iterator();
  while (cursor.hasNext()) {
    descendants.add(new ActuatorsGroup(cursor.next().toJson().toString()));
  }
  return descendants;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>funzioni all&#8217;interno di UserThread:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void activateService() {
	Vector&lt;ActuatorsGroup&gt; actuatorsGroups = (Vector&lt;ActuatorsGroup&gt;) receiveAesDecryptedObject();
	String service = receiveAesDecryptedString();
	String commandLineParameters = receiveAesDecryptedString();
	Vector&lt;ActuatorsGroup&gt; allGroups = getGroupsForService(actuatorsGroups);
	requestService(allGroups, service, commandLineParameters);
}

private Vector&lt;ActuatorsGroup&gt; getGroupsForService(Vector&lt;ActuatorsGroup&gt; actuatorsGroups) {
	Iterator&lt;ActuatorsGroup&gt; it = actuatorsGroups.iterator();
	Vector&lt;ActuatorsGroup&gt; allGroups = new Vector&lt;ActuatorsGroup&gt;();
	Vector&lt;ActuatorsGroup&gt; descendants;
	ActuatorsGroup ag = null;
	while (it.hasNext()) {
		ag = it.next();
		if (!dbm.isUserAllowed(ag, lm.getNickname()))
			continue;
		ag = dbm.getCompleteInformations(ag);
		// I check if the user can access to this actuators group

		allGroups.add(ag);
		descendants = dbm.getDescendantsActuatorsGroup(ag);
		if (descendants.size() &gt; 0) {
			allGroups.addAll(descendants);
		}
	}
	return allGroups;
}

/**
 * it sends an HTTP requests to the servers of the groups to activate the
 * services
 *
 * @param groups
 *            all the groups that you want to get access.
 * @param service
 *            the service that you want to activate
 * @param commandLineParameters
 *            the parameters for the service
 */
public void requestService(Vector&lt;ActuatorsGroup&gt; groups, String service, String commandLineParameters) {
	String server;
	Iterator&lt;ActuatorsGroup&gt; i;
	ActuatorsGroup ag;
	Vector&lt;String&gt; groupsIp = new Vector&lt;String&gt;();
	while (groups.size() &gt; 0) {
		server = groups.get(0).getServer().getIpPort();
		i = groups.iterator();
		while (i.hasNext()) {
			ag = i.next();
			if (ag.getServer().getIpPort().equals(server)) {
				groupsIp.add(ag.getIp());
				i.remove();
			}
		}
		requestServiceToServer(server, groupsIp, service, commandLineParameters);
		groupsIp.removeAllElements();
	}
}

private void requestServiceToServer(String serverIpPort, Vector&lt;String&gt; groupsIpOfTheServer, String service,
    String commandLineParameters) {
  String url = "http://" + serverIpPort + "/basicService";
  List&lt;NameValuePair&gt; urlParameters = new ArrayList&lt;NameValuePair&gt;();

  String groupsIpString = groupsIpOfTheServer.toString().replace("[", "").replace("]", "").replace(" ", "");
  urlParameters.add(new BasicNameValuePair("groupsIps", groupsIpString));
  if (commandLineParameters != null) {
    urlParameters.add(new BasicNameValuePair("service", service));
    urlParameters.add(new BasicNameValuePair("commandLineParameters", commandLineParameters));
  }
  try {
    http.sendPost(url, urlParameters);
  } catch (Exception e) {
    e.printStackTrace();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Oltre a questa modalità di attivazione sono presenti anche quelle mediante tags e group tags.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gruppi_di_sensori">4.2.3. Gruppi di sensori</h4>
<div class="paragraph">
<p>Per quanto riguarda i gruppi di sensori, invece, verranno mostrate all&#8217;utente solo le misure dei sensori a cui l&#8217;utente è abilitato ad accedere. Quando vengono richieste le misure di un gruppo, infatti, il server remoto fornisce solo le misure dei sensori del gruppo a cui l’utente è abilitato ad accedere.</p>
</div>
<div class="paragraph">
<p>Per chiarire meglio l&#8217;accesso ai gruppi di sensori viene riportata la parte di codice che se ne occupa:</p>
</div>
<div class="sect4">
<h5 id="_lettura_di_misure_di_gruppi_di_sensori">Lettura di misure di gruppi di sensori</h5>
<div class="paragraph">
<p>Funzione all&#8217;interno di UserThread:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void sendSensorsGroupMeasurements() {
	SensorsGroup group = (SensorsGroup) receiveAesDecryptedObject();
	// I pass the nickname of the user in order to send only the
	// measurements that he is able to see
	sendAesEncryptedObject(dbm.getMeasurements(group, lm.getNickname()));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>funzioni all&#8217;interno di DBManager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 *
 * @param group
 * @param username
 * @return the measurements of the group and the measurements of the
 *         descendants of that group, but only those ones that the user is
 *         allowed to see
 *
 */
public Vector&lt;Measurement&gt; getMeasurements(SensorsGroup group, String username) {
	Vector&lt;SensorsGroup&gt; descendants = getDescendantsSensorsGroup(group);
	Vector&lt;Sensor&gt; sensors = getSensors(group);
	Iterator&lt;SensorsGroup&gt; descendantsIt = descendants.iterator();
	SensorsGroup sg;
	while (descendantsIt.hasNext()) {
		sg = descendantsIt.next();
		sg.setAdmin(getNickname(sg.getAdmin()));
		sensors.addAll(getSensors(sg));
	}
	Vector&lt;Measurement&gt; measurements = new Vector&lt;Measurement&gt;();
	Iterator&lt;Sensor&gt; it = sensors.iterator();
	Sensor s;
	while (it.hasNext()) {
		s = it.next();
		s.setOwner(getNickname(s.getOwner()));
		if (isUserAllowedForSensor(s, username))
			measurements.addAll(s.getMeasurements());
	}
	return measurements;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gestione_della_privacy_e_della_sicurezza">4.3. Gestione della privacy e della sicurezza</h3>
<div class="sect3">
<h4 id="_approccio_ibrido_sql_e_nosql">4.3.1. Approccio ibrido SQL e NoSQL</h4>
<div class="paragraph">
<p>Visto il requisito del server di non poter salvare dati personali nel cloud si è utilizzato un approccio ibrido in cui tutti i dati personali sono salvati in un database SQL insieme all&#8217;ID dell&#8217;utente, che viene generato dal database stesso, mentre tutti gli altri dati vengono salvati nel database MongoDB, identificando ogni utente solo mediante il suo ID.</p>
</div>
<div class="paragraph">
<p>In questo modo nel cloud non vi sono username, password, email e altri dati che si potrebbero aggiungere in future versioni del software come nome, cognome, eccetera, ma solamente un ID, la cui corrispondenza con gli altri dati si può trovare unicamente consultando il database relazionale.</p>
</div>
</div>
<div class="sect3">
<h4 id="_accesso_ai_dispositivi">4.3.2. Accesso ai dispositivi</h4>
<div class="paragraph">
<p>Nel capitolo precedente abbiamo detto che possono accedere ai vari disposotivi solamente gli utenti abilitati a farlo. A titolo di esempio riportiamo il codice che si occupa di verificare che un utente sia abilitato ad accedere a un sensore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public Boolean isUserAllowedForSensor(Sensor sensor, String username) {
	// try {
	if (isSensorPublic(sensor) || sensor.getOwner().equals(username)) {
		return true;
	} else {
		// I check if one of the Users Group of the user is able
		// to access to the sensor
		Vector&lt;UsersGroup&gt; userGroups = getUsersGroups(username);
		Iterator&lt;UsersGroup&gt; it = userGroups.iterator();
		UsersGroup ug;
		while (it.hasNext()) {
			ug = it.next();
			ug.setAdmin(getNickname(ug.getAdmin()));
			if (isUsersGroupAllowedForSensor(sensor, ug)) {
				return true;
			}
		}
	}
	return false;
}

private Boolean isUsersGroupAllowedForSensor(Sensor sensor, UsersGroup ug) {
	return isUsersGroupAllowedForSensor(sensor.getName(), sensor.getOwner(), ug.getName(), ug.getAdmin());
}

public Boolean isUsersGroupAllowedForSensor(String sensorName, String owner, String groupName, String groupAdmin) {
	return isGroupAllowedForSensor(sensorName, owner, getUsersGroupId(groupName, groupAdmin),
			DatabaseDefines.ALLOWED_USERS_GROUPS);
}

private Boolean isGroupAllowedForSensor(String sensorName, String owner, ObjectId groupId, String field) {
  MongoCursor&lt;Document&gt; cursor = db.getCollection(DatabaseDefines.SENSORS_COLLECTION)
      .find(and(eq(DatabaseDefines.NAME, sensorName), eq(DatabaseDefines.OWNER, getUserId(owner)),
          eq(field, groupId)))
      .iterator();
  return cursor.hasNext();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gestione_delle_chiavi">4.3.3. Gestione delle chiavi</h4>
<div class="paragraph">
<p>Per gestire al meglio le chiavi sono stati seguiti i seguenti accorgimenti:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dopo che si registra, l&#8217;utente crea una cartella, chiamata come il suo username, che contiene la chiave pubblica e privata RSA dell&#8217;utente e la chiave simmetrica AES. La chiave pubblica RSA del server non è in questa cartella ma è nella cartella superiore a questa, ovvero quella in cui sono contenute le varie cartelle degli username. Questo perché la chiave pubblica rsa del server è comune a tutti gli utenti.</p>
</li>
<li>
<p>E' stata creata la classe KeysManager, che serve a gestire chiavi AES e RSA. Le chiavi vengono scritte e lette sui file, però quando viene fatta una operazione di questo tipo la chiave viene aggiunta al dizionario delle chiavi, una struttura dati che risiede in memoria e che, quindi, offre dei tempi di lettura più brevi di quelli del disco fisso creando, così, un meccanismo di caching, che evita di fare una lettura a file tutte le volte che serve una determinata chiave.</p>
</li>
<li>
<p>Nel server, la chiave AES di ogni utente viene salvata nel database SQL come Blob, criptandola con la chiave pubblica RSA del server, in modo tale che possa essere decriptata solo con la chiave privata del server.</p>
</li>
<li>
<p>Il server non salva la chiave pubblica del client, in quanto la utilizza solamente quando deve mandare la chiave simmetrica Aes al client e, siccome si assume che questa operazione avviene poche volte, è uno spreco di memoria salvarla e, dunque, si è preferito preferito mandarla ogni volta che il client richiede la propria chiave simmetrica.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shell">4.4. Shell</h3>
<div class="paragraph">
<p>Si riportano di seguito i menu che vengono presentati rispettivamente al client e all&#8217;amministratore del server, che fungono anche da riassunto delle funzionalità del sistema.</p>
</div>
<div class="sect3">
<h4 id="_lato_client">4.4.1. Lato client</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Enter:
1	Login
2	Sign up
3	Quit</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_login_effettuato">Login effettuato</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Enter:
1	Get Measures
2	Services
3	Sensors
4	My servers
5	Users Groups
6	My Devices Groups
7	Logout
8	Delete Account
9	Quit</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_1_get_measures">1 Get Measures</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Get sensor measurements
2	Get sensors measurements by tags
3	Get sensors group measurements
4	Get sensors groups measurements by tags
5	Get sensors group measurements by position</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_services">2	Services</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	New service
2	Activate Service
3	Activate service by tags
4	Activate service by group tags</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_sensors">3	Sensors</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Add allowed devices groups
2	Add allowed users groups
3	Add sensor to group
4	Add tag to sensor
5	Delete sensor from sensors group
6	Show my devices
7	Insert new sensor
8	Delete sensor</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_users_groups">5	Users Groups</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Add users to my group
2	Add tags to my group
3	Get the groups I belong
4	Get users of a group
5	New users group
6	Delete user from users group
7	Exit from group
8	Get my users groups</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_6_my_devices_groups">6	My Devices Groups</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Add tags to actuators group
2	Add tags to sensors group
3	Add allowed users groups to actuators group
4	New Devices Group
5	Get my sensors group
6	Get my actuators group</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lato_server">4.4.2. Lato server</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Enter:
1	Print Online users
2	Generate a new Key Pair
3	Print Server Key Pair
4	Set key size
5	Brands and Models
6	Quit
7	Sensors and Actuators
8	Users
9	Drop a collection</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_5_brands_and_models">5 Brands and Models</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Insert a new brand
2	Delete a brand
3	Insert a new model
4	Delete a model</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_7_sensors_and_actuators">7 Sensors and Actuators</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Print Sensors Collection
2	Print Sensors group Collection
3	Print Actuators group Collection</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_8_users">8 Users</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>1	Print Sensors Collection
2	Print Sensors group Collection
3	Print Actuators group Collection</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diagramma_delle_classi">4.5. Diagramma delle classi</h3>
<div class="paragraph">
<p>Di seguito vengono rappresentati i diagrammi delle classi di tutta la parte del codice in Java.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Actuator.png" alt="Actuator">
</div>
<div class="title">Figure 15. Diagramma della classe Actuator</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/ActuatorsGroup.png" alt="ActuatorsGroup">
</div>
<div class="title">Figure 16. Diagramma della classe ActuatorsGroup</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Client.png" alt="Client">
</div>
<div class="title">Figure 17. Diagramma della classe Client</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/ClientLoginManager.png" alt="ClientLoginManager">
</div>
<div class="title">Figure 18. Diagramma della classe ClientLoginManager</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/DBManager.png" alt="DBManager">
</div>
<div class="title">Figure 19. Diagramma della classe DBManager</div>
</div>
<div class="paragraph">
<p>Le dipendenze della classe DBManager sono troppe per essere riportare nell&#8217;immagine e, quindi, vengono elencate qui di seguito:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ActuatorsGroup (groups.ActuatorsGroup)</p>
</li>
<li>
<p>ArrayList&lt;E&gt; (java.util.ArrayList&lt;E&gt;)</p>
</li>
<li>
<p>Boolean (java.lang.Boolean) «final»</p>
</li>
<li>
<p>Device (devices.Device) «abstract»</p>
</li>
<li>
<p>Document (org.bson.Document)</p>
</li>
<li>
<p>Double (java.lang.Double) «final»</p>
</li>
<li>
<p>GenericalGroup (genericalClasses.GenericalGroup) «abstract»</p>
</li>
<li>
<p>GenericalServer (genericalClasses.GenericalServer)</p>
</li>
<li>
<p>Measurement (devices.Measurement)</p>
</li>
<li>
<p>MongoCursor&lt;TResult&gt; (com.mongodb.client.MongoCursor&lt;TResult&gt;) «abstract» «interface»</p>
</li>
<li>
<p>ObjectId (org.bson.types.ObjectId) «final»</p>
</li>
<li>
<p>RSAPrivateKey (java.security.interfaces.RSAPrivateKey) «abstract» «interface»</p>
</li>
<li>
<p>RSAPublicKey (java.security.interfaces.RSAPublicKey) «abstract» «interface»</p>
</li>
<li>
<p>Sensor (devices.Sensor)</p>
</li>
<li>
<p>SensorsGroup (groups.SensorsGroup)</p>
</li>
<li>
<p>String (java.lang.String) «final»</p>
</li>
<li>
<p>UsersGroup (genericalClasses.UsersGroup)</p>
</li>
<li>
<p>Vector&lt;E&gt; (java.util.Vector&lt;E&gt;)</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Decrypter.png" alt="Decrypter">
</div>
<div class="title">Figure 20. Diagramma della classe Decrypter</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Device.png" alt="Device">
</div>
<div class="title">Figure 21. Diagramma della classe Device</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/DevicesGroup.png" alt="DevicesGroup">
</div>
<div class="title">Figure 22. Diagramma della classe DevicesGroup</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Encrypter.png" alt="Encrypter">
</div>
<div class="title">Figure 23. Diagramma della classe Encrypter</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/FileChooserThread.png" alt="FileChooserThread">
</div>
<div class="title">Figure 24. Diagramma della classe FileChooserThread</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/FileManager.png" alt="FileManager">
</div>
<div class="title">Figure 25. Diagramma della classe FileManager</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/GenericalGroup.png" alt="GenericalGroup">
</div>
<div class="title">Figure 26. Diagramma della classe GenericalGroup</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/GenericalServer.png" alt="GenericalServer">
</div>
<div class="title">Figure 27. Diagramma della classe GenericalServer</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/HashManager.png" alt="HashManager">
</div>
<div class="title">Figure 28. Diagramma della classe HashManager</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/HTTPClient.png" alt="HTTPClient">
</div>
<div class="title">Figure 29. Diagramma della classe HTTPClient</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/HTTPFileHandler.png" alt="HTTPFileHandler">
</div>
<div class="title">Figure 30. Diagramma della classe HTTPFileHandler</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/HTTPServer.png" alt="HTTPServer">
</div>
<div class="title">Figure 31. Diagramma della classe HTTPServer</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/KeysManager.png" alt="KeysManager">
</div>
<div class="title">Figure 32. Diagramma della classe KeysManager</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Measurement.png" alt="Measurement">
</div>
<div class="title">Figure 33. Diagramma della classe Measurement</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/MenuThread.png" alt="MenuThread">
</div>
<div class="title">Figure 34. Diagramma della classe MenuThread</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/NetworkHelper.png" alt="NetworkHelper">
</div>
<div class="title">Figure 35. Diagramma della classe NetworkHelper</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Sensor.png" alt="Sensor">
</div>
<div class="title">Figure 36. Diagramma della classe Sensor</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/SensorsGroup.png" alt="SensorsGroup">
</div>
<div class="title">Figure 37. Diagramma della classe SensorsGroup</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/Server.png" alt="Server">
</div>
<div class="title">Figure 38. Diagramma della classe Server</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/ServerLoginManager.png" alt="ServerLoginManager">
</div>
<div class="title">Figure 39. Diagramma della classe ServerLoginManager</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/StringManager.png" alt="StringManager">
</div>
<div class="title">Figure 40. Diagramma della classe StringManager</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/TaggedObject.png" alt="TaggedObject">
</div>
<div class="title">Figure 41. Diagramma della classe TaggedObject</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/UsersGroup.png" alt="UsersGroup">
</div>
<div class="title">Figure 42. Diagramma della classe UsersGroup</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/UserThread.png" alt="UserThread">
</div>
<div class="title">Figure 43. Diagramma della classe UserThread</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/WaitingThread.png" alt="WaitingThread">
</div>
<div class="title">Figure 44. Diagramma della classe WaitingThread</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="class_diagrams/XmlManager.png" alt="XmlManager">
</div>
<div class="title">Figure 45. Diagramma della classe XmlManager</div>
</div>
</div>
<div class="sect2">
<h3 id="_ulteriori_dettagli">4.6. Ulteriori dettagli</h3>
<div class="paragraph">
<p>Si riportano di seguito altri dettagli implementativi. Se qualcosa non è stato trattato in questo capitolo si invita a consultare l&#8217;appendice, in cui è presente tutto il codice scritto per questo progetto.</p>
</div>
<div class="sect3">
<h4 id="_installazione_delle_dipendenze">4.6.1. Installazione delle dipendenze</h4>
<div class="paragraph">
<p>Per installare le dipendenze richieste da python e dal coapthon sono state eseguite le seguenti istruzioni:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo sudo apt-get install libmysqlclient-dev
$ sudo easy_install MySQL-python
$ sudo easy_install Twisted sudo apt-get install python-sphinx
$ sudo easy_install bitstring sudo easy_install futures</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_correzione_della_gestione_del_log">4.6.2. Correzione della gestione del log</h4>
<div class="paragraph">
<p>Nel coap protocol si è modificata la gestione del log per una corretta simulazione di più componenti del sistema(interruttori, server, attuatori, ecc.) su una sola macchina. Prima, infatti, tutti i componenti scrivevano sullo stesso file. In particolare, all&#8217;interno di ogni progetto nei defines, si è aggiunto il campo COAP_LOG_DIRECTORY, che ora specifica qual è il file log di ogni progetto, che specifica la cartella di ogni file di log per ogni componente.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sperimentazione">5. Sperimentazione</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si ripropone qui di seguito un esempio utilizzato per testare il sistema, in cui quest&#8217;ultimo è stato utilizzato per creare uno Smart Building Activity Based.</p>
</div>
<div class="sect2">
<h3 id="_scenario_di_riferimento_2">5.1. Scenario di riferimento</h3>
<div class="paragraph">
<p>Lo scenario di riferimento è quello di un edificio di un campus, di cui si vuole gestire l&#8217;impianto di riscaldamento in maniera intelligente.</p>
</div>
<div class="paragraph">
<p>La struttura dell&#8217;edificio è la seguente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vi sono 4 piani;</p>
</li>
<li>
<p>delle scale dividono l&#8217;edificio in due blocchi;</p>
</li>
<li>
<p>un piano e un blocco identificano una zona, che è costituita da un corridoio, delle stanze e un bagno.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I vari spazi dell&#8217;edificio sono suddivisi nel seguente modo:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/struttura_building.jpg" alt="Struttura dell'edificio">
</div>
<div class="title">Figure 46. Struttura dell&#8217;edificio</div>
</div>
<div class="paragraph">
<p>Gli oggetti che consentono il riscaldamento intelligente dell&#8217;edificio sono:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sensori di temperatura e umidità</p>
</li>
<li>
<p>fonti di calore comandabili dall&#8217;esterno</p>
</li>
<li>
<p>interruttori, che vengono attivati quando vi è la presenza di almeno una persona nell&#8217;ambiente</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I sensori e le fonti di calore sono posizionate in tutti gli ambienti, ovvero nei corridoi, nelle stanze e nelle scale e possono essere presenti in numero variabile a seconda delle esigenze dello specifico ambiente, mentre in ogni stanza è presente un solo interruttore.</p>
</div>
</div>
<div class="sect2">
<h3 id="_obiettivo">5.2. Obiettivo</h3>
<div class="paragraph">
<p>L&#8217;obiettivo è quello di mantenere le persone all’interno dell&#8217;edificio in condizioni termiche di benessere, consumando meno energia possibile, ovvero attivando
solamente le fonti di calore necessarie.</p>
</div>
<div class="paragraph">
<p>Ad esempio, sapendo che nel blocco B, al secondo piano in un laboratorio c&#8217;è un gruppo di persone al lavoro, l&#8217;impianto di riscaldamento dovrà permettere
l&#8217;attivazione ed il controllo delle fonti di calore posizionate nel corridoio e nei bagni degli uffici, nelle scale fino al secondo piano, nel corridoio e
nei bagni dei laboratori del secondo piano e nel laboratorio dove vi sono le persone che stanno lavorando.</p>
</div>
</div>
<div class="sect2">
<h3 id="_soluzione_sviluppata">5.3. Soluzione sviluppata</h3>
<div class="paragraph">
<p>Per risolvere la problematica sopra descritta, all&#8217;interno dell&#8217;edificio è inserito un server CoAP, a cui i sensori di temperatura e umidità mandano le loro
misurazioni e i vari interruttori che segnalano la presenza delle persone richiedono l&#8217;attivazione di un servizio, a seconda se essi vengono attivati o
disattivati. In base al servizio richiesto e alle misure dei sensori, il server invia il segnale di attivazione o
spegnimento a determinate fonti di calore che, quindi, rappresentano gli attuatori del sistema.</p>
</div>
<div class="paragraph">
<p>Queste ultime sono organizzate in gruppi multicast, dunque il server avrà il vantaggio di interfacciarsi con esse e non con le singole fonti di calore,
portando ad un&#8217;efficiente gestione dell&#8217;intero sistema, riducendo i ritardi ed ottimizzando le prestazioni del sistema di comunicazione.</p>
</div>
<div class="paragraph">
<p>Il comportamento di ogni attuatore all&#8217;interno del gruppo viene personalizzato mediante l&#8217;ausilio dei tag, che verranno inviati dal server CoAP
a seconda della temperatura e dell&#8217;umidità presenti all&#8217;interno dell&#8217;ambiente.</p>
</div>
<div class="paragraph">
<p>Infatti, se il server dall&#8217;interruttore che richiede il servizio deduce a quali gruppi accedere, dalle misurazioni dei sensori ricava quali tag mandargli,
poichè questi ultimi vengono scelti in base alle condizioni climatiche dell&#8217;ambiente in cui il gruppo di attuatori è inserito.</p>
</div>
<div class="paragraph">
<p>I tag possibili per gli attuatori sono "cold", "cold-warm", "warm", "warm-hot", "hot". Predisponendo i vari attuatori con una combinazione di questi vari tag, è possibile ottenere la giusta quantità di fonti di calore attive in base alla necessità climatica del momento, che viene fornita dai sensori.</p>
</div>
<div class="paragraph">
<p>Per capire quali gruppi di attuatori attivare, invece, viene sfruttata la posizione dell&#8217;interruttore dell&#8217;illuminazione elettrica. Quest&#8217;ultimo, infatti,
viene attivato quando è presente qualcuno nella stanza e viene disattivato quando non vi è nessuno.</p>
</div>
<div class="paragraph">
<p>Sfuttando la posizione dell&#8217;interrutore, dunque, è possibile decidere quali gruppi di attuatori attivare, perchè da essa vengono dedotti tutti gli ambienti in cui le persone che si trovano in quella stanza vorrebbero accedere e, in particolare, si stabilisce che per delle persone che si trovano in una determinata stanza bisogna riscaldare tutto il percorso che porta a quella determinata stanza e il bagno della zona della stanza.</p>
</div>
<div class="paragraph">
<p>Il percorso che porta ad una stanza è costituito da:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il corridoio di ingresso (che è quello presente nella zona degli uffici)</p>
</li>
<li>
<p>le scale che portano fino al piano della stanza</p>
</li>
<li>
<p>il corridoio della zona della stanza</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In base a queste caratteristiche è stato sviluppato un albero che rappresenta la struttura dell&#8217;edificio:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/gerarchia_building.png" alt="Gerarchia dell'edificio">
</div>
<div class="title">Figure 47. Gerarchia dell&#8217;edificio</div>
</div>
<div class="paragraph">
<p>Nello schema in Figura 5.2 mancano le stanze. Esse sono state omesse per garantire la leggibilità della figura, ma bisogna considerare che i gruppi in arancione hanno come sottogruppi tutte le stanze che il corridoio contiene.</p>
</div>
<div class="paragraph">
<p>Non sono da considerare invece i bagni, semplicemente perchè essi non hanno bisogno di una trattazione diversa rispetto ai corridoi in quanto, in tutti i
possibili scenari che possono presentarsi, i riscaldamenti dei bagni vanno sempre attivati insieme a quelli dei corridoi e quindi appartengono allo stesso gruppo multicast.</p>
</div>
<div class="paragraph">
<p>Quando un interruttore di illuminazione di una stanza viene attivato, dunque, il server parte dal nodo della stanza in cui era presente l&#8217;interruttore e
ripercorre la gerarchia in Figura 5.2 verso l&#8217;alto attivando, dunque, il nodo stesso e tutti i suoi antenati.</p>
</div>
<div class="paragraph">
<p>Ad esempio, se venisse attivato l&#8217;interruttore appartenente a un laboratorio appartenente ai laboratori del secondo piano verrebbero attivati i gruppi appartenenti a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il laboratorio stesso;</p>
</li>
<li>
<p>il corridoio dei laboratori del secondo piano;</p>
</li>
<li>
<p>la scala al secondo piano;</p>
</li>
<li>
<p>la scala al primo piano;</p>
</li>
<li>
<p>la scala al piano terra;</p>
</li>
<li>
<p>il corridoio degli uffici.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quando un interruttore viene disattivato, invece, il server manda il comando a quel gruppo di attuatori di disattivarsi, in modo che le fonti di calori di
quella stanza si spengano e ripercorre, come in precedenza, la gerarchia verso l&#8217;alto e controlla se esiste almeno un figlio attivo per ogni nodo nell&#8217;albero mostrato in Figura 5.2.
Se quest&#8217;ultima condizione non è vera, allora il server manda il comando di spegnersi anche a quel gruppo, perchè significa che non vi sono persone che stanno in quelle zone o che devono transitarvi.</p>
</div>
<div class="paragraph">
<p>I sensori devono appartenere a gruppi di sensori che devono essere chiamati come i gruppi di attuatori appartenenti agli attuatori che si trovano nello stesso
ambiente dei sensori stessi. In questo modo si capisce il clima dell&#8217;ambiente di ogni gruppo di fonti di calore.</p>
</div>
</div>
<div class="sect2">
<h3 id="_possibili_scenari">5.4. Possibili scenari</h3>
<div class="paragraph">
<p>Gli scenari che sono stati considerati nella sperimentazione di questa tesi sono descritti nelle sezioni seguenti.</p>
</div>
<div class="sect3">
<h4 id="_mattinata_fredda_infrasettimanale">5.4.1. Mattinata fredda infrasettimanale</h4>
<div class="paragraph">
<p>Tutte le zone dell&#8217;università sono utilizzate, tranne la zona delle riunioni. Nelle sale riunioni, dunque, gli interruttori saranno spenti e dunque il server non accenderà né le singole sale nè il corridoio che porta ad esse nè il bagno della zona riunioni.</p>
</div>
<div class="paragraph">
<p>I sensori delle varie zone, inoltre, indicano che ci sono una temperatura e un&#8217;umidità molto al di sotto della temperatura ottimale e, dunque, sarà necessario riscaldare velocemente gli ambienti.
Il server manderà il tag "cold" ai vari gruppi di attuatori che si trovano nelle zone interessate dalla presenza di studenti, professori e personale tecnico-amministrativo.
Se gli attuatori sono stati impostati in maniera adeguata, tutti sono configurati con il tag "cold" e iniziano a lavorare ad alto regime.</p>
</div>
</div>
<div class="sect3">
<h4 id="_giornata_di_sola_attività_amministrativa">5.4.2. Giornata di sola attività amministrativa</h4>
<div class="paragraph">
<p>In giornate particolari, come ad esempio il 28, il 29 e il 30 Dicembre, gli unici a lavorare all&#8217;interno del campus è il personale tecnico-amministrativo.
In queste giornate vi è il maggior risparmio di energia possibile (escludendo quelle dove l&#8217;università è completamente chiusa ovviamente),
poichè basterà riscaldare solamente la zona degli uffici, ovvero il bagno della zona degli uffici, il corridoio d&#8217;ingresso e gli uffici.</p>
</div>
<div class="paragraph">
<p>Dalle altre stanze, infatti, gli interruttori risulteranno disattivati e, dunque, non vi sarà nessun gruppo ad essere attivato oltre a quelli citati precedentemente</p>
</div>
</div>
<div class="sect3">
<h4 id="_riunione_di_dipartimento_in_una_giornata_calda">5.4.3. Riunione di dipartimento in una giornata calda</h4>
<div class="paragraph">
<p>Durante la riunione di dipartimento si presume che la maggior parte delle persone siano impegnate nelle sale riunioni, dunque gli interruttori di queste
sale saranno accesi. Si ipotizzi però che vi siano dei ricercatori non impegnati in sala riunione e che si trovano in un laboratorio al terzo piano.
In questo caso i gruppi di attuatori attivati saranno quelli appartenti ai seguenti ambienti:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il corridoio degli uffici</p>
</li>
<li>
<p>il bagno degli uffici</p>
</li>
<li>
<p>le scale fino al terzo piano</p>
</li>
<li>
<p>il corridoio che conduce alle sale riunioni</p>
</li>
<li>
<p>le sale riunioni impegnate</p>
</li>
<li>
<p>il bagno delle sale riunioni</p>
</li>
<li>
<p>il laboratorio impegnato dai ricercatori</p>
</li>
<li>
<p>i bagni della zona dei laboratori del terzo piano</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Riducendo il numero di ambienti riscaldati, c&#8217;è un risparmio in termini di fonti di energia globale utilizzata per il riscaldamento dell&#8217;edificio.</p>
</div>
<div class="paragraph">
<p>Se la giornata è abbastanza calda, quindi il server manda ai gruppi il tag "hot".
Se gli attuatori sono stati impostati in maniera adeguata pochi attuatori hanno il tag "hot", poichè in questa situazione non c&#8217;è bisogno di riscaldare molto e,
dunque, si ha la necessità di poche fonti di calore attive.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inserimento_dei_dati_nel_sistema">5.5. Inserimento dei dati nel sistema</h3>
<div class="paragraph">
<p>Una volta che sono stati identificati e caratterizzati tutti gli attuatori dell&#8217;edificio, questi vengono organizzati in gruppi.
I gruppi di attuatori vengono inseriti nel sistema tramite la voce di menù "New Actuators Group", che si trova all&#8217;interno del menù "My devices Groups" - "New Devices Group". In particolare, rispetto ai nomi presenti nella gerarchia di Figura 5.2 sono stati eliminati i punti e gli spazi sono stati sostituiti da un underscore, quindi ad esempio "corr. uffici" è diventato "corr_uffici".</p>
</div>
<div class="paragraph">
<p>L&#8217;inserimento del gruppo "scala piano terra", per esempio, è il seguente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>name: scala_piano_terra
public [Y/n]: y
description (optional): il gruppo che contiene tutti gli attuatori presenti nella scala del piano terra
parent group name (optional): corr_uffici
tag (optional):

IP(optional) : 228.5.6.9
server data:
IP: 127.0.0.1
port: 8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il gruppo nell&#8217;esempio ha il campo tag vuoto, in quanto i tag caratterizzano i singoli attuatori e non il gruppo a cui appartengono, poichè lo scopo di utilizzare i tag è proprio quello di ottenere un comportamento differenziato tra gli attuatori appartenenti allo stesso gruppo.</p>
</div>
<div class="paragraph">
<p>Ai fini della nostra sperimentazione, oltre ai gruppi visibili nella gerarchia, sono stati inseriti i gruppi "ufficio1" e "ufficio2" come sottogruppi del gruppo "corr_uffici" e il gruppo "laboratorio1" come sottogruppo del gruppo "corr_laboratorio_2_piano".</p>
</div>
<div class="paragraph">
<p>I tag vengono inseriti all&#8217;interno di un file xml chiamato "tag.xml", che è presente in ogni attuatore. Quando l&#8217;attuatore si accende, legge il contenuto di questo file e carica i tag contenuti al suo interno in un array. Quando arriva un comando dal server, l&#8217;attuatore esegue il comando solo se il tag inviato dal server è contenuto all&#8217;interno dell&#8217;array dei tag.</p>
</div>
<div class="paragraph">
<p>Ad esempio se in un attuatore si vogliono mettere i tag "hot" e "warm-hot" il file tag.xml sarà il seguente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;tags&gt;
  &lt;tag&gt;hot&lt;/tag&gt;
  &lt;tag&gt;warm-hot&lt;/tag&gt;
&lt;/tags&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>I sensori vengono registrati mediante la voce di menù "Insert new sensor" presente nel sottomenù "Sensors". Si riporta l&#8217;esempio di un inserimento di un sensore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>name: sensore_finestra1
server: myserver
public [Y/n]: y
model (optional): SHT15
brand (optional): Sensirion
latitude (optional):
tag (optional):</code></pre>
</div>
</div>
<div class="paragraph">
<p>Come si può vedere i campi latitude e tag non sono stati inseriti perchè per questa applicazione non erano utili, ma il loro funzionamento è stato comunque testato a parte ed è risultato funzionante.</p>
</div>
<div class="paragraph">
<p>I gruppi di sensori vengono inseriti mediante la voce di menù "New Sensors Group", che si trova all&#8217;interno del menù "My devices Groups" - "New Devices Group".
Ecco un esempio dell&#8217;inserimento del gruppo "ufficio1", che è una stanza del gruppo "corr_uffici".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>name: ufficio1
public [Y/n]: y
description (optional): gruppo che contiene tutti i sensori presenti nella stanza "ufficio1"
parent group name (optional): corr_uffici
tag (optional):</code></pre>
</div>
</div>
<div class="paragraph">
<p>I sensori vengono aggiunti ai gruppi mediante la voce di menù "Add sensor to group" presente nel sottomenù "Sensors". Di seguito si riporta l&#8217;esempio effettuato per aggiungere il gruppo "sensore_finestra1" al gruppo "ufficio1".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sensor name: sensore_finestra1
group name: ufficio1</code></pre>
</div>
</div>
<div class="paragraph">
<p>All&#8217;interno file di configurazione xml dell&#8217;interruttore chiamato "conf_interrutore.xml", invece, il campo locazione corrisponde al nome del gruppo della stanza in cui esso è inserito. Quando l&#8217;interruttore si accende, legge la locazione all&#8217;interno di questo file e la carica in una variabile in memoria. Ogni volta che l&#8217;interruttore viene attivato o disattivato, insieme al suo stato invia anche il contenuto di questa variabile, in modo tale da indicare la posizione dell&#8217;interruttore.</p>
</div>
<div class="paragraph">
<p>Ad esempio per la stanza "ufficio1", il file di configurazione si presenterà semplicemente così:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0"?&gt;
&lt;root&gt;
    &lt;locazione&gt;salone1&lt;/locazione&gt;
&lt;/root&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusioni_e_sviluppi_futuri">Conclusioni e sviluppi futuri</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I requisiti della tesi sono stati rispettati e tutti gli obiettivi sono stati raggiunti con successo, creando un sistema che sposa a pieno i principi di riferimento dell&#8217;Internet of Things e che permette di accedere ai propri dispositivi o a quelli a cui si è abilitati a farlo in maniera sicura ed affidabile, combinando in modo appropriato HTTP e CoAP e utilizzando la crittografia e un approccio ibrido tra SQL e NoSQL per salvaguardare i dati dell&#8217;utente.</p>
</div>
<div class="paragraph">
<p>Il sistema, inoltre, permette di creare servizi personalizzati e di installarli sui propri server e di accedere ai dispositivi con meccanismi user-frienly come gruppi di dispositivi o tag.</p>
</div>
<div class="paragraph">
<p>Il lavoro di questa tesi viene portato avanti da agosto 2014, quando io e il mio collega Davide Foti (che ringrazio infinatamente per l&#8217;aiuto che mi ha dato) ci siamo cominciati a informare sul CoAP e abbiamo cominciato a testare le sue varie implementazioni. La tesi è stata conclusa, invece, a dicembre 2015.</p>
</div>
<div class="paragraph">
<p>Per il futuro potrebbe essere introdotto un versioning dei vari servizi, in modo tale da permettere una gestione più avanzata all&#8217;utente oppure si potrebbe creare un meccanismo di condivisione dei servizi, in modo tale da poter visualizzare i servizi pubblici degli altri utenti e installarli nei propri server,
Inoltre, potrebbe essere effettuato l&#8217;aggiornamento a coapthon 3, visto che lo sviluppo del sistema è iniziato prima del suo rilascio e, quindi, si è usato coapthon 2.</p>
</div>
<div class="sect2">
<h3 id="_strumenti_utilizzati">Strumenti utilizzati</h3>
<div class="paragraph">
<p>Per realizzare questa tesi sono stati utilizzati solamente programmi free e, per la maggior parte, open source, ovvero:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Eclipse</dt>
<dd>
<p>Per la programmazione in Java e in Python. Sono stati installati, inoltre, i plugin PyDev, essenziale per python e M2Eclipse, per integrare maven in eclipse.</p>
</dd>
<dt class="hdlist1">Maven</dt>
<dd>
<p>Per risolvere tutte le dipendenze esterne senza scaricare manualmente le librerie</p>
</dd>
<dt class="hdlist1">Asccidoc e Asciidoctor</dt>
<dd>
<p>Il primo come formato della tesi e il secondo per convertirla in PDF</p>
</dd>
<dt class="hdlist1">Atom e Gedit</dt>
<dd>
<p>Come editor di testo per modificare la tesi</p>
</dd>
<dt class="hdlist1">yED</dt>
<dd>
<p>Per la creazione degli schemi</p>
</dd>
<dt class="hdlist1"><a href="https://www.websequencediagrams.com/" class="bare">https://www.websequencediagrams.com/</a></dt>
<dd>
<p>Per la creazione dei sequence diagram</p>
</dd>
<dt class="hdlist1">Class Visualizer</dt>
<dd>
<p>Per la creazione dei diagrammi delle classi</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossario">Glossario</h2>
<div class="sectionbody">
<div class="dlist glossary">
<dl>
<dt>Accesso a un dispositivo</dt>
<dd>
<p>Per un sensore si intende leggere le misurazioni effettuate da esso mentre, per un attuatore, significa controllarlo.</p>
</dd>
<dt>server CoAP</dt>
<dd>
<p>Server di frontiera di ogni sottorete</p>
</dd>
<dt>server remoto</dt>
<dd>
<p>Server centrale, a cui fanno riferimento tutti i server CoAP</p>
</dd>
<dt>servizi utente</dt>
<dd>
<p>Servizi che vengono creati dall&#8217;utente</p>
</dd>
<dt>servizi admin</dt>
<dd>
<p>Servizi già presenti nel sistema</p>
</dd>
<dt>Disaster recovery</dt>
<dd>
<p>L&#8217;insieme delle misure tecnologiche e logistico/organizzative atte a ripristinare sistemi, dati e infrastrutture necessarie all&#8217;erogazione di servizi di business per imprese, associazioni o enti, a fronte di gravi emergenze che ne intacchino la regolare attività <sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</sup></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliografia">Bibliografia</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?tp=&amp;arnumber=7057586" class="bare">http://ieeexplore.ieee.org/xpl/articleDetails.jsp?tp=&amp;arnumber=7057586</a></p>
</li>
<li>
<p>Dharshan, "Understanding durability &amp; write safety in MongoDB", 8/8/2014. <a href="http://blog.mongodirector.com/understanding-durability-write-safety-in-mongodb/" class="bare">http://blog.mongodirector.com/understanding-durability-write-safety-in-mongodb/</a></p>
</li>
<li>
<p><a href="https://it.wikipedia.org/wiki/MongoDB" class="bare">https://it.wikipedia.org/wiki/MongoDB</a></p>
</li>
<li>
<p><a href="http://coap.technology" class="bare">http://coap.technology</a></p>
</li>
<li>
<p>Joe Weinman, "Defining a cloud", 18/01/2014. <a href="http://www.techradar.com/news/internet/cloud-services/defining-a-cloud-1209348" class="bare">http://www.techradar.com/news/internet/cloud-services/defining-a-cloud-1209348</a></p>
</li>
<li>
<p><a id="joeweinman_website"></a> <a href="http://joeweinman.com" class="bare">http://joeweinman.com</a></p>
</li>
<li>
<p>Dan Allen. Seam in Action. Manning Publications. 2008.</p>
</li>
<li>
<p>Peter Mell&#44; Timothy Grance, The NIST Definition of Cloud Computing. NIST&#44; Special Publication 800-145&amp;#44 Settembre 2011.</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=nxrU3-7Ait4" class="bare">https://www.youtube.com/watch?v=nxrU3-7Ait4</a></p>
</li>
<li>
<p>Joe Weinman, "Cloudonomics: A Rigorous Approach to Cloud Benefit Quantification", Ott 2011. <a href="https://www.csiac.org/sites/default/files/journal_files/stn14_4.pdf" class="bare">https://www.csiac.org/sites/default/files/journal_files/stn14_4.pdf</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. fonte: <a href="https://it.wikipedia.org/wiki/MongoDB" class="bare">https://it.wikipedia.org/wiki/MongoDB</a>
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. <a href="http://tools.ietf.org/html/rfc7228" class="bare">http://tools.ietf.org/html/rfc7228</a>
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. fonte: <a href="http://www.joeweinman.com/bio.htm" class="bare">http://www.joeweinman.com/bio.htm</a>
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. <a href="https://it.wikipedia.org/wiki/Cloud_computing" class="bare">https://it.wikipedia.org/wiki/Cloud_computing</a>
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. Joe Weinman, “Defining a cloud”, <a href="http://www.techradar.com/news/internet/cloud-services/defining-a-cloud-1209348" class="bare">http://www.techradar.com/news/internet/cloud-services/defining-a-cloud-1209348</a>
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. Ottobre 2011, <a href="https://www.csiac.org/sites/default/files/journal_files/stn14_4.pdf" class="bare">https://www.csiac.org/sites/default/files/journal_files/stn14_4.pdf</a>
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. Joe Weinman, "What&#8217;s the real reason to do cloud, again?“, 3 ottobre 2014. <a href="http://www.cloudcomputing-news.net/news/2014/oct/03/whats-the-real-reason-to-do-cloud-again/" class="bare">http://www.cloudcomputing-news.net/news/2014/oct/03/whats-the-real-reason-to-do-cloud-again/</a>
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. Joe Weinman, The Nuances of Cloud Economics (le sfumature del Cloud Economics), <a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?tp=&amp;arnumber=7057586" class="bare">http://ieeexplore.ieee.org/xpl/articleDetails.jsp?tp=&amp;arnumber=7057586</a>
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. fonte: Joe Weinman, "Hybrid Cloud: The Best of Both Worlds", <a href="http://blogs.technet.com/b/server-cloud/archive/2015/02/04/hybrid-cloud-the-best-of-both-worlds-an-introduction-to-the-benefits-of-hybrid-cloud.aspx" class="bare">http://blogs.technet.com/b/server-cloud/archive/2015/02/04/hybrid-cloud-the-best-of-both-worlds-an-introduction-to-the-benefits-of-hybrid-cloud.aspx</a>
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. fonte <a href="http://blog.mongodirector.com/understanding-durability-write-safety-in-MongoDB/" class="bare">http://blog.mongodirector.com/understanding-durability-write-safety-in-MongoDB/</a>
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. <a href="http://code.google.com/p/jcoap/" class="bare">http://code.google.com/p/jcoap/</a>
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. <a href="http://people.inf.ethz.ch/mkovatsc/californium.php" class="bare">http://people.inf.ethz.ch/mkovatsc/californium.php</a>
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. <a href="http://github.com/eclipse/californium/tree/1.0.0-M2" class="bare">http://github.com/eclipse/californium/tree/1.0.0-M2</a>
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. <a href="https://it.wikipedia.org/wiki/Disaster_recovery" class="bare">https://it.wikipedia.org/wiki/Disaster_recovery</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-08-02 00:27:28 PDT
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>